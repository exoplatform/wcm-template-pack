<?xml version="1.0" encoding="UTF-8"?><jquery.flexslider.js xmlns:nt="http://www.jcp.org/jcr/nt/1.0" xmlns:xcmis="http://www.exoplatform.com/jcr/xcmis/1.0" xmlns:tkn="http://www.gatein.org/jcr/token/1.0/" xmlns:webdav="http://www.exoplatform.org/jcr/webdav" xmlns:gtn="http://www.gatein.org/jcr/gatein/1.0/" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:plf="http://www.exoplatform.org/jcr/plf/1.0/" xmlns:jcr="http://www.jcp.org/jcr/1.0" xmlns:wsrp="http://www.gatein.org/jcr/wsrp/1.0/" xmlns:sv="http://www.jcp.org/jcr/sv/1.0" xmlns:ntf="http://www.gatein.org/jcr/ntf/1.0/" xmlns:wiki="http://exoplatform.org/wiki/1.0/" xmlns:jos="http://www.exoplatform.com/jcr-services/organization-service/1.0/" xmlns:fn="http://www.w3.org/2005/xpath-functions" xmlns:metadata="http://www.exoplatform.com/jcr/metadata/1.1/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:app="http://www.gatein.org/jcr/application-registry/1.0/" xmlns:exoide="http://exoplatform.org/ide/1.1.x/" xmlns:stg="http://www.gatein.org/jcr/stg/1.0/" xmlns:cmis="http://www.exoplatform.com/jcr/cmis/1.0" xmlns:acme="http://www.exoplatform.com/plf/acme/4.0/" xmlns:lgn="http://www.gatein.org/jcr/autologin/1.0/" xmlns:mop="http://www.gatein.org/jcr/mop/1.0/" xmlns:fn_old="http://www.w3.org/2004/10/xpath-functions" xmlns:mix="http://www.jcp.org/jcr/mix/1.0" xmlns:publication="http://www.exoplatform.com/jcr/publication/1.1/" xmlns:exo="http://www.exoplatform.com/jcr/exo/1.0" xmlns:pc="http://www.gatein.org/jcr/pc/1.0/" xmlns:wai="http://www.exoplatform.com/ecm/accessibility/1.0" xmlns:soc="http://www.exoplatform.org/jcr/soc/1.0/" xmlns:portlet="http://www.gatein.org/jcr/portlet/1.0/" xmlns:rep="internal" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" jcr:primaryType="nt:file" jcr:mixinTypes="exo:sortable exo:owneable mix:referenceable exo:modify exo:jsFile exo:datetime mix:commentable mix:votable mix:i18n publication:authoring publication:authoringPublication mix:versionable exo:activityInfo" jcr:uuid="9f2f43cf7f0000010cbdff8be8beb221" exo:active="true" exo:activityId="9f2f43fd7f00000133d9f0367c94b952" exo:dateCreated="2015-05-29T17:19:44.470+07:00" exo:dateModified="2015-05-29T17:19:44.502+07:00" exo:index="1000" exo:language="en" exo:lastModifiedDate="2015-05-29T17:19:44.984+07:00" exo:lastModifier="root" exo:name="jquery.flexslider.js" exo:owner="root" exo:presentationType="exo:jsFile" exo:priority="0" exo:sharedJS="true" exo:title="jquery.flexslider.js" exo:voteTotal="0" exo:voteTotalOfLang="0" exo:votingRate="0.0" publication:currentState="draft" publication:history="jquery.flexslider.js;enrolled;root;2015-05-29T17:19:44.500+07:00;Publication.log.description.enrolled jquery.flexslider.js;draft;root;2015-05-29T17:19:44.501+07:00;PublicationService.AuthoringPublicationPlugin.changeState.draft" publication:lastUser="root" publication:lifecycle="lifecycle1" publication:lifecycleName="Authoring_x0020_publication" publication:revisionData="9f2f43cf7f0000010cbdff8be8beb221,draft,root" jcr:baseVersion="9f2f43f37f0000014d5c703b6811af36" jcr:created="2015-05-29T17:19:44.463+07:00" jcr:isCheckedOut="true" jcr:predecessors="9f2f43f37f0000014d5c703b6811af36" jcr:versionHistory="9f2f43f37f00000104eca9435bbe68f5"><jcr:content jcr:primaryType="nt:resource" jcr:mixinTypes="exo:owneable exo:datetime dc:elementSet" jcr:uuid="9f2f43e17f0000015f51913e4904b8fc" exo:dateCreated="2015-05-29T17:19:44.482+07:00" exo:dateModified="2015-05-29T17:19:44.482+07:00" exo:internalUse="false" exo:owner="root" jcr:data="DQoNCjsoZnVuY3Rpb24gKCQpIHsNCg0KICAvL0ZsZXhTbGlkZXI6IE9iamVjdCBJbnN0YW5jZQ0KICAkLmZsZXhzbGlkZXIgPSBmdW5jdGlvbihlbCwgb3B0aW9ucykgew0KICAgIHZhciBzbGlkZXIgPSAkKGVsKSwNCiAgICAgICAgdmFycyA9ICQuZXh0ZW5kKHt9LCAkLmZsZXhzbGlkZXIuZGVmYXVsdHMsIG9wdGlvbnMpLA0KICAgICAgICBuYW1lc3BhY2UgPSB2YXJzLm5hbWVzcGFjZSwNCiAgICAgICAgdG91Y2ggPSAoIm9udG91Y2hzdGFydCIgaW4gd2luZG93KSB8fCB3aW5kb3cuRG9jdW1lbnRUb3VjaCAmJiBkb2N1bWVudCBpbnN0YW5jZW9mIERvY3VtZW50VG91Y2gsDQogICAgICAgIGV2ZW50VHlwZSA9ICh0b3VjaCkgPyAidG91Y2hlbmQiIDogImNsaWNrIiwNCiAgICAgICAgdmVydGljYWwgPSB2YXJzLmRpcmVjdGlvbiA9PT0gInZlcnRpY2FsIiwNCiAgICAgICAgcmV2ZXJzZSA9IHZhcnMucmV2ZXJzZSwNCiAgICAgICAgY2Fyb3VzZWwgPSAodmFycy5pdGVtV2lkdGggPiAwKSwNCiAgICAgICAgZmFkZSA9IHZhcnMuYW5pbWF0aW9uID09PSAiZmFkZSIsDQogICAgICAgIGFzTmF2ID0gdmFycy5hc05hdkZvciAhPT0gIiIsDQogICAgICAgIG1ldGhvZHMgPSB7fTsNCiAgICANCiAgICAvLyBTdG9yZSBhIHJlZmVyZW5jZSB0byB0aGUgc2xpZGVyIG9iamVjdA0KICAgICQuZGF0YShlbCwgImZsZXhzbGlkZXIiLCBzbGlkZXIpOw0KICAgIA0KICAgIC8vIFByaXZhdCBzbGlkZXIgbWV0aG9kcw0KICAgIG1ldGhvZHMgPSB7DQogICAgICBpbml0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgc2xpZGVyLmFuaW1hdGluZyA9IGZhbHNlOw0KICAgICAgICBzbGlkZXIuY3VycmVudFNsaWRlID0gdmFycy5zdGFydEF0Ow0KICAgICAgICBzbGlkZXIuYW5pbWF0aW5nVG8gPSBzbGlkZXIuY3VycmVudFNsaWRlOw0KICAgICAgICBzbGlkZXIuYXRFbmQgPSAoc2xpZGVyLmN1cnJlbnRTbGlkZSA9PT0gMCB8fCBzbGlkZXIuY3VycmVudFNsaWRlID09PSBzbGlkZXIubGFzdCk7DQogICAgICAgIHNsaWRlci5jb250YWluZXJTZWxlY3RvciA9IHZhcnMuc2VsZWN0b3Iuc3Vic3RyKDAsdmFycy5zZWxlY3Rvci5zZWFyY2goJyAnKSk7DQogICAgICAgIHNsaWRlci5zbGlkZXMgPSAkKHZhcnMuc2VsZWN0b3IsIHNsaWRlcik7DQogICAgICAgIHNsaWRlci5jb250YWluZXIgPSAkKHNsaWRlci5jb250YWluZXJTZWxlY3Rvciwgc2xpZGVyKTsNCiAgICAgICAgc2xpZGVyLmNvdW50ID0gc2xpZGVyLnNsaWRlcy5sZW5ndGg7DQogICAgICAgIC8vIFNZTkM6DQogICAgICAgIHNsaWRlci5zeW5jRXhpc3RzID0gJCh2YXJzLnN5bmMpLmxlbmd0aCA+IDA7DQogICAgICAgIC8vIFNMSURFOg0KICAgICAgICBpZiAodmFycy5hbmltYXRpb24gPT09ICJzbGlkZSIpIHZhcnMuYW5pbWF0aW9uID0gInN3aW5nIjsNCiAgICAgICAgc2xpZGVyLnByb3AgPSAodmVydGljYWwpID8gInRvcCIgOiAibWFyZ2luTGVmdCI7DQogICAgICAgIHNsaWRlci5hcmdzID0ge307DQogICAgICAgIC8vIFNMSURFU0hPVzoNCiAgICAgICAgc2xpZGVyLm1hbnVhbFBhdXNlID0gZmFsc2U7DQogICAgICAgIC8vIFRPVUNIL1VTRUNTUzoNCiAgICAgICAgc2xpZGVyLnRyYW5zaXRpb25zID0gIXZhcnMudmlkZW8gJiYgIWZhZGUgJiYgdmFycy51c2VDU1MgJiYgKGZ1bmN0aW9uKCkgew0KICAgICAgICAgIHZhciBvYmogPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwNCiAgICAgICAgICAgICAgcHJvcHMgPSBbJ3BlcnNwZWN0aXZlUHJvcGVydHknLCAnV2Via2l0UGVyc3BlY3RpdmUnLCAnTW96UGVyc3BlY3RpdmUnLCAnT1BlcnNwZWN0aXZlJywgJ21zUGVyc3BlY3RpdmUnXTsNCiAgICAgICAgICBmb3IgKHZhciBpIGluIHByb3BzKSB7DQogICAgICAgICAgICBpZiAoIG9iai5zdHlsZVsgcHJvcHNbaV0gXSAhPT0gdW5kZWZpbmVkICkgew0KICAgICAgICAgICAgICBzbGlkZXIucGZ4ID0gcHJvcHNbaV0ucmVwbGFjZSgnUGVyc3BlY3RpdmUnLCcnKS50b0xvd2VyQ2FzZSgpOw0KICAgICAgICAgICAgICBzbGlkZXIucHJvcCA9ICItIiArIHNsaWRlci5wZnggKyAiLXRyYW5zZm9ybSI7DQogICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0oKSk7DQogICAgICAgIC8vIENPTlRST0xTQ09OVEFJTkVSOg0KICAgICAgICBpZiAodmFycy5jb250cm9sc0NvbnRhaW5lciAhPT0gIiIpIHNsaWRlci5jb250cm9sc0NvbnRhaW5lciA9ICQodmFycy5jb250cm9sc0NvbnRhaW5lcikubGVuZ3RoID4gMCAmJiAkKHZhcnMuY29udHJvbHNDb250YWluZXIpOw0KICAgICAgICAvLyBNQU5VQUw6DQogICAgICAgIGlmICh2YXJzLm1hbnVhbENvbnRyb2xzICE9PSAiIikgc2xpZGVyLm1hbnVhbENvbnRyb2xzID0gJCh2YXJzLm1hbnVhbENvbnRyb2xzKS5sZW5ndGggPiAwICYmICQodmFycy5tYW51YWxDb250cm9scyk7DQogICAgICAgIA0KICAgICAgICAvLyBSQU5ET01JWkU6DQogICAgICAgIGlmICh2YXJzLnJhbmRvbWl6ZSkgew0KICAgICAgICAgIHNsaWRlci5zbGlkZXMuc29ydChmdW5jdGlvbigpIHsgcmV0dXJuIChNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkpLTAuNSk7IH0pOw0KICAgICAgICAgIHNsaWRlci5jb250YWluZXIuZW1wdHkoKS5hcHBlbmQoc2xpZGVyLnNsaWRlcyk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHNsaWRlci5kb01hdGgoKTsNCiAgICAgICAgDQogICAgICAgIC8vIEFTTkFWOg0KICAgICAgICBpZiAoYXNOYXYpIG1ldGhvZHMuYXNOYXYuc2V0dXAoKTsNCiAgICAgICAgDQogICAgICAgIC8vIElOSVQNCiAgICAgICAgc2xpZGVyLnNldHVwKCJpbml0Iik7DQogICAgICAgIA0KICAgICAgICAvLyBDT05UUk9MTkFWOg0KICAgICAgICBpZiAodmFycy5jb250cm9sTmF2KSBtZXRob2RzLmNvbnRyb2xOYXYuc2V0dXAoKTsNCiAgICAgICAgDQogICAgICAgIC8vIERJUkVDVElPTk5BVjoNCiAgICAgICAgaWYgKHZhcnMuZGlyZWN0aW9uTmF2KSBtZXRob2RzLmRpcmVjdGlvbk5hdi5zZXR1cCgpOw0KICAgICAgICANCiAgICAgICAgLy8gS0VZQk9BUkQ6DQogICAgICAgIGlmICh2YXJzLmtleWJvYXJkICYmICgkKHNsaWRlci5jb250YWluZXJTZWxlY3RvcikubGVuZ3RoID09PSAxIHx8IHZhcnMubXVsdGlwbGVLZXlib2FyZCkpIHsNCiAgICAgICAgICAkKGRvY3VtZW50KS5iaW5kKCdrZXl1cCcsIGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICAgICAgICB2YXIga2V5Y29kZSA9IGV2ZW50LmtleUNvZGU7DQogICAgICAgICAgICBpZiAoIXNsaWRlci5hbmltYXRpbmcgJiYgKGtleWNvZGUgPT09IDM5IHx8IGtleWNvZGUgPT09IDM3KSkgew0KICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gKGtleWNvZGUgPT09IDM5KSA/IHNsaWRlci5nZXRUYXJnZXQoJ25leHQnKSA6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAoa2V5Y29kZSA9PT0gMzcpID8gc2xpZGVyLmdldFRhcmdldCgncHJldicpIDogZmFsc2U7DQogICAgICAgICAgICAgIHNsaWRlci5mbGV4QW5pbWF0ZSh0YXJnZXQsIHZhcnMucGF1c2VPbkFjdGlvbik7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgLy8gTU9VU0VXSEVFTDoNCiAgICAgICAgaWYgKHZhcnMubW91c2V3aGVlbCkgew0KICAgICAgICAgIHNsaWRlci5iaW5kKCdtb3VzZXdoZWVsJywgZnVuY3Rpb24oZXZlbnQsIGRlbHRhLCBkZWx0YVgsIGRlbHRhWSkgew0KICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIHZhciB0YXJnZXQgPSAoZGVsdGEgPCAwKSA/IHNsaWRlci5nZXRUYXJnZXQoJ25leHQnKSA6IHNsaWRlci5nZXRUYXJnZXQoJ3ByZXYnKTsNCiAgICAgICAgICAgIHNsaWRlci5mbGV4QW5pbWF0ZSh0YXJnZXQsIHZhcnMucGF1c2VPbkFjdGlvbik7DQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIFBBVVNFUExBWQ0KICAgICAgICBpZiAodmFycy5wYXVzZVBsYXkpIG1ldGhvZHMucGF1c2VQbGF5LnNldHVwKCk7DQogICAgICAgIA0KICAgICAgICAvLyBTTElEU0VTSE9XDQogICAgICAgIGlmICh2YXJzLnNsaWRlc2hvdykgew0KICAgICAgICAgIGlmICh2YXJzLnBhdXNlT25Ib3Zlcikgew0KICAgICAgICAgICAgc2xpZGVyLmhvdmVyKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICBpZiAoIXNsaWRlci5tYW51YWxQbGF5ICYmICFzbGlkZXIubWFudWFsUGF1c2UpIHNsaWRlci5wYXVzZSgpOw0KICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgIGlmICghc2xpZGVyLm1hbnVhbFBhdXNlICYmICFzbGlkZXIubWFudWFsUGxheSkgc2xpZGVyLnBsYXkoKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgICAvLyBpbml0aWFsaXplIGFuaW1hdGlvbg0KICAgICAgICAgICh2YXJzLmluaXREZWxheSA+IDApID8gc2V0VGltZW91dChzbGlkZXIucGxheSwgdmFycy5pbml0RGVsYXkpIDogc2xpZGVyLnBsYXkoKTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gVE9VQ0gNCiAgICAgICAgaWYgKHRvdWNoICYmIHZhcnMudG91Y2gpIG1ldGhvZHMudG91Y2goKTsNCiAgICAgICAgDQogICAgICAgIC8vIEZBREUmJlNNT09USEhFSUdIVCB8fCBTTElERToNCiAgICAgICAgaWYgKCFmYWRlIHx8IChmYWRlICYmIHZhcnMuc21vb3RoSGVpZ2h0KSkgJCh3aW5kb3cpLmJpbmQoInJlc2l6ZSBmb2N1cyIsIG1ldGhvZHMucmVzaXplKTsNCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICAvLyBBUEk6IHN0YXJ0KCkgQ2FsbGJhY2sNCiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpew0KICAgICAgICAgIHZhcnMuc3RhcnQoc2xpZGVyKTsNCiAgICAgICAgfSwgMjAwKTsNCiAgICAgIH0sDQogICAgICBhc05hdjogew0KICAgICAgICBzZXR1cDogZnVuY3Rpb24oKSB7DQogICAgICAgICAgc2xpZGVyLmFzTmF2ID0gdHJ1ZTsNCiAgICAgICAgICBzbGlkZXIuYW5pbWF0aW5nVG8gPSBNYXRoLmZsb29yKHNsaWRlci5jdXJyZW50U2xpZGUvc2xpZGVyLm1vdmUpOw0KICAgICAgICAgIHNsaWRlci5jdXJyZW50SXRlbSA9IHNsaWRlci5jdXJyZW50U2xpZGU7DQogICAgICAgICAgc2xpZGVyLnNsaWRlcy5yZW1vdmVDbGFzcyhuYW1lc3BhY2UgKyAiYWN0aXZlLXNsaWRlIikuZXEoc2xpZGVyLmN1cnJlbnRJdGVtKS5hZGRDbGFzcyhuYW1lc3BhY2UgKyAiYWN0aXZlLXNsaWRlIik7DQogICAgICAgICAgc2xpZGVyLnNsaWRlcy5jbGljayhmdW5jdGlvbihlKXsNCiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIHZhciAkc2xpZGUgPSAkKHRoaXMpLA0KICAgICAgICAgICAgICAgIHRhcmdldCA9ICRzbGlkZS5pbmRleCgpOw0KICAgICAgICAgICAgaWYgKCEkKHZhcnMuYXNOYXZGb3IpLmRhdGEoJ2ZsZXhzbGlkZXInKS5hbmltYXRpbmcgJiYgISRzbGlkZS5oYXNDbGFzcygnYWN0aXZlJykpIHsNCiAgICAgICAgICAgICAgc2xpZGVyLmRpcmVjdGlvbiA9IChzbGlkZXIuY3VycmVudEl0ZW0gPCB0YXJnZXQpID8gIm5leHQiIDogInByZXYiOw0KICAgICAgICAgICAgICBzbGlkZXIuZmxleEFuaW1hdGUodGFyZ2V0LCB2YXJzLnBhdXNlT25BY3Rpb24sIGZhbHNlLCB0cnVlLCB0cnVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgIGNvbnRyb2xOYXY6IHsNCiAgICAgICAgc2V0dXA6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgIGlmICghc2xpZGVyLm1hbnVhbENvbnRyb2xzKSB7DQogICAgICAgICAgICBtZXRob2RzLmNvbnRyb2xOYXYuc2V0dXBQYWdpbmcoKTsNCiAgICAgICAgICB9IGVsc2UgeyAvLyBNQU5VQUxDT05UUk9MUzoNCiAgICAgICAgICAgIG1ldGhvZHMuY29udHJvbE5hdi5zZXR1cE1hbnVhbCgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgc2V0dXBQYWdpbmc6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgIHZhciB0eXBlID0gKHZhcnMuY29udHJvbE5hdiA9PT0gInRodW1ibmFpbHMiKSA/ICdjb250cm9sLXRodW1icycgOiAnY29udHJvbC1wYWdpbmcnLA0KICAgICAgICAgICAgICBqID0gMSwNCiAgICAgICAgICAgICAgaXRlbTsNCiAgICAgICAgICANCiAgICAgICAgICBzbGlkZXIuY29udHJvbE5hdlNjYWZmb2xkID0gJCgnPG9sIGNsYXNzPSInKyBuYW1lc3BhY2UgKyAnY29udHJvbC1uYXYgJyArIG5hbWVzcGFjZSArIHR5cGUgKyAnIj48L29sPicpOw0KICAgICAgICAgIA0KICAgICAgICAgIGlmIChzbGlkZXIucGFnaW5nQ291bnQgPiAxKSB7DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNsaWRlci5wYWdpbmdDb3VudDsgaSsrKSB7DQogICAgICAgICAgICAgIGl0ZW0gPSAodmFycy5jb250cm9sTmF2ID09PSAidGh1bWJuYWlscyIpID8gJzxpbWcgc3JjPSInICsgc2xpZGVyLnNsaWRlcy5lcShpKS5hdHRyKCJkYXRhLXRodW1iIikgKyAnIi8+JyA6ICc8YT4nICsgaiArICc8L2E+JzsNCiAgICAgICAgICAgICAgc2xpZGVyLmNvbnRyb2xOYXZTY2FmZm9sZC5hcHBlbmQoJzxsaT4nICsgaXRlbSArICc8L2xpPicpOw0KICAgICAgICAgICAgICBqKys7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICAgIA0KICAgICAgICAgIC8vIENPTlRST0xTQ09OVEFJTkVSOg0KICAgICAgICAgIChzbGlkZXIuY29udHJvbHNDb250YWluZXIpID8gJChzbGlkZXIuY29udHJvbHNDb250YWluZXIpLmFwcGVuZChzbGlkZXIuY29udHJvbE5hdlNjYWZmb2xkKSA6IHNsaWRlci5hcHBlbmQoc2xpZGVyLmNvbnRyb2xOYXZTY2FmZm9sZCk7DQogICAgICAgICAgbWV0aG9kcy5jb250cm9sTmF2LnNldCgpOw0KICAgICAgICAgIA0KICAgICAgICAgIG1ldGhvZHMuY29udHJvbE5hdi5hY3RpdmUoKTsNCiAgICAgICAgDQogICAgICAgICAgc2xpZGVyLmNvbnRyb2xOYXZTY2FmZm9sZC5kZWxlZ2F0ZSgnYSwgaW1nJywgZXZlbnRUeXBlLCBmdW5jdGlvbihldmVudCkgew0KICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyksDQogICAgICAgICAgICAgICAgdGFyZ2V0ID0gc2xpZGVyLmNvbnRyb2xOYXYuaW5kZXgoJHRoaXMpOw0KDQogICAgICAgICAgICBpZiAoISR0aGlzLmhhc0NsYXNzKG5hbWVzcGFjZSArICdhY3RpdmUnKSkgew0KICAgICAgICAgICAgICBzbGlkZXIuZGlyZWN0aW9uID0gKHRhcmdldCA+IHNsaWRlci5jdXJyZW50U2xpZGUpID8gIm5leHQiIDogInByZXYiOw0KICAgICAgICAgICAgICBzbGlkZXIuZmxleEFuaW1hdGUodGFyZ2V0LCB2YXJzLnBhdXNlT25BY3Rpb24pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICAgIC8vIFByZXZlbnQgaU9TIGNsaWNrIGV2ZW50IGJ1Zw0KICAgICAgICAgIGlmICh0b3VjaCkgew0KICAgICAgICAgICAgc2xpZGVyLmNvbnRyb2xOYXZTY2FmZm9sZC5kZWxlZ2F0ZSgnYScsICJjbGljayB0b3VjaHN0YXJ0IiwgZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgc2V0dXBNYW51YWw6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgIHNsaWRlci5jb250cm9sTmF2ID0gc2xpZGVyLm1hbnVhbENvbnRyb2xzOw0KICAgICAgICAgIG1ldGhvZHMuY29udHJvbE5hdi5hY3RpdmUoKTsNCiAgICAgICAgICANCiAgICAgICAgICBzbGlkZXIuY29udHJvbE5hdi5saXZlKGV2ZW50VHlwZSwgZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLA0KICAgICAgICAgICAgICAgIHRhcmdldCA9IHNsaWRlci5jb250cm9sTmF2LmluZGV4KCR0aGlzKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIGlmICghJHRoaXMuaGFzQ2xhc3MobmFtZXNwYWNlICsgJ2FjdGl2ZScpKSB7DQogICAgICAgICAgICAgICh0YXJnZXQgPiBzbGlkZXIuY3VycmVudFNsaWRlKSA/IHNsaWRlci5kaXJlY3Rpb24gPSAibmV4dCIgOiBzbGlkZXIuZGlyZWN0aW9uID0gInByZXYiOw0KICAgICAgICAgICAgICBzbGlkZXIuZmxleEFuaW1hdGUodGFyZ2V0LCB2YXJzLnBhdXNlT25BY3Rpb24pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICAgIC8vIFByZXZlbnQgaU9TIGNsaWNrIGV2ZW50IGJ1Zw0KICAgICAgICAgIGlmICh0b3VjaCkgew0KICAgICAgICAgICAgc2xpZGVyLmNvbnRyb2xOYXYubGl2ZSgiY2xpY2sgdG91Y2hzdGFydCIsIGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIHNldDogZnVuY3Rpb24oKSB7DQogICAgICAgICAgdmFyIHNlbGVjdG9yID0gKHZhcnMuY29udHJvbE5hdiA9PT0gInRodW1ibmFpbHMiKSA/ICdpbWcnIDogJ2EnOw0KICAgICAgICAgIHNsaWRlci5jb250cm9sTmF2ID0gJCgnLicgKyBuYW1lc3BhY2UgKyAnY29udHJvbC1uYXYgbGkgJyArIHNlbGVjdG9yLCAoc2xpZGVyLmNvbnRyb2xzQ29udGFpbmVyKSA/IHNsaWRlci5jb250cm9sc0NvbnRhaW5lciA6IHNsaWRlcik7DQogICAgICAgIH0sDQogICAgICAgIGFjdGl2ZTogZnVuY3Rpb24oKSB7DQogICAgICAgICAgc2xpZGVyLmNvbnRyb2xOYXYucmVtb3ZlQ2xhc3MobmFtZXNwYWNlICsgImFjdGl2ZSIpLmVxKHNsaWRlci5hbmltYXRpbmdUbykuYWRkQ2xhc3MobmFtZXNwYWNlICsgImFjdGl2ZSIpOw0KICAgICAgICB9LA0KICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKGFjdGlvbiwgcG9zKSB7DQogICAgICAgICAgaWYgKHNsaWRlci5wYWdpbmdDb3VudCA+IDEgJiYgYWN0aW9uID09PSAiYWRkIikgew0KICAgICAgICAgICAgc2xpZGVyLmNvbnRyb2xOYXZTY2FmZm9sZC5hcHBlbmQoJCgnPGxpPjxhPicgKyBzbGlkZXIuY291bnQgKyAnPC9hPjwvbGk+JykpOw0KICAgICAgICAgIH0gZWxzZSBpZiAoc2xpZGVyLnBhZ2luZ0NvdW50ID09PSAxKSB7DQogICAgICAgICAgICBzbGlkZXIuY29udHJvbE5hdlNjYWZmb2xkLmZpbmQoJ2xpJykucmVtb3ZlKCk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNsaWRlci5jb250cm9sTmF2LmVxKHBvcykuY2xvc2VzdCgnbGknKS5yZW1vdmUoKTsNCiAgICAgICAgICB9DQogICAgICAgICAgbWV0aG9kcy5jb250cm9sTmF2LnNldCgpOw0KICAgICAgICAgIChzbGlkZXIucGFnaW5nQ291bnQgPiAxICYmIHNsaWRlci5wYWdpbmdDb3VudCAhPT0gc2xpZGVyLmNvbnRyb2xOYXYubGVuZ3RoKSA/IHNsaWRlci51cGRhdGUocG9zLCBhY3Rpb24pIDogbWV0aG9kcy5jb250cm9sTmF2LmFjdGl2ZSgpOw0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgZGlyZWN0aW9uTmF2OiB7DQogICAgICAgIHNldHVwOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICB2YXIgZGlyZWN0aW9uTmF2U2NhZmZvbGQgPSAkKCc8dWwgY2xhc3M9IicgKyBuYW1lc3BhY2UgKyAnZGlyZWN0aW9uLW5hdiI+PGxpPjxhIGNsYXNzPSInICsgbmFtZXNwYWNlICsgJ3ByZXYiIGhyZWY9IiMiPicgKyB2YXJzLnByZXZUZXh0ICsgJzwvYT48L2xpPjxsaT48YSBjbGFzcz0iJyArIG5hbWVzcGFjZSArICduZXh0IiBocmVmPSIjIj4nICsgdmFycy5uZXh0VGV4dCArICc8L2E+PC9saT48L3VsPicpOw0KICAgICAgICANCiAgICAgICAgICAvLyBDT05UUk9MU0NPTlRBSU5FUjoNCiAgICAgICAgICBpZiAoc2xpZGVyLmNvbnRyb2xzQ29udGFpbmVyKSB7DQogICAgICAgICAgICAkKHNsaWRlci5jb250cm9sc0NvbnRhaW5lcikuYXBwZW5kKGRpcmVjdGlvbk5hdlNjYWZmb2xkKTsNCiAgICAgICAgICAgIHNsaWRlci5kaXJlY3Rpb25OYXYgPSAkKCcuJyArIG5hbWVzcGFjZSArICdkaXJlY3Rpb24tbmF2IGxpIGEnLCBzbGlkZXIuY29udHJvbHNDb250YWluZXIpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBzbGlkZXIuYXBwZW5kKGRpcmVjdGlvbk5hdlNjYWZmb2xkKTsNCiAgICAgICAgICAgIHNsaWRlci5kaXJlY3Rpb25OYXYgPSAkKCcuJyArIG5hbWVzcGFjZSArICdkaXJlY3Rpb24tbmF2IGxpIGEnLCBzbGlkZXIpOw0KICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgbWV0aG9kcy5kaXJlY3Rpb25OYXYudXBkYXRlKCk7DQogICAgICAgIA0KICAgICAgICAgIHNsaWRlci5kaXJlY3Rpb25OYXYuYmluZChldmVudFR5cGUsIGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgdmFyIHRhcmdldCA9ICgkKHRoaXMpLmhhc0NsYXNzKG5hbWVzcGFjZSArICduZXh0JykpID8gc2xpZGVyLmdldFRhcmdldCgnbmV4dCcpIDogc2xpZGVyLmdldFRhcmdldCgncHJldicpOw0KICAgICAgICAgICAgc2xpZGVyLmZsZXhBbmltYXRlKHRhcmdldCwgdmFycy5wYXVzZU9uQWN0aW9uKTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgICAvLyBQcmV2ZW50IGlPUyBjbGljayBldmVudCBidWcNCiAgICAgICAgICBpZiAodG91Y2gpIHsNCiAgICAgICAgICAgIHNsaWRlci5kaXJlY3Rpb25OYXYuYmluZCgiY2xpY2sgdG91Y2hzdGFydCIsIGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7DQogICAgICAgICAgdmFyIGRpc2FibGVkQ2xhc3MgPSBuYW1lc3BhY2UgKyAnZGlzYWJsZWQnOw0KICAgICAgICAgIGlmIChzbGlkZXIucGFnaW5nQ291bnQgPT09IDEpIHsNCiAgICAgICAgICAgIHNsaWRlci5kaXJlY3Rpb25OYXYuYWRkQ2xhc3MoZGlzYWJsZWRDbGFzcyk7DQogICAgICAgICAgfSBlbHNlIGlmICghdmFycy5hbmltYXRpb25Mb29wKSB7DQogICAgICAgICAgICBpZiAoc2xpZGVyLmFuaW1hdGluZ1RvID09PSAwKSB7DQogICAgICAgICAgICAgIHNsaWRlci5kaXJlY3Rpb25OYXYucmVtb3ZlQ2xhc3MoZGlzYWJsZWRDbGFzcykuZmlsdGVyKCcuJyArIG5hbWVzcGFjZSArICJwcmV2IikuYWRkQ2xhc3MoZGlzYWJsZWRDbGFzcyk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKHNsaWRlci5hbmltYXRpbmdUbyA9PT0gc2xpZGVyLmxhc3QpIHsNCiAgICAgICAgICAgICAgc2xpZGVyLmRpcmVjdGlvbk5hdi5yZW1vdmVDbGFzcyhkaXNhYmxlZENsYXNzKS5maWx0ZXIoJy4nICsgbmFtZXNwYWNlICsgIm5leHQiKS5hZGRDbGFzcyhkaXNhYmxlZENsYXNzKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIHNsaWRlci5kaXJlY3Rpb25OYXYucmVtb3ZlQ2xhc3MoZGlzYWJsZWRDbGFzcyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNsaWRlci5kaXJlY3Rpb25OYXYucmVtb3ZlQ2xhc3MoZGlzYWJsZWRDbGFzcyk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgcGF1c2VQbGF5OiB7DQogICAgICAgIHNldHVwOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICB2YXIgcGF1c2VQbGF5U2NhZmZvbGQgPSAkKCc8ZGl2IGNsYXNzPSInICsgbmFtZXNwYWNlICsgJ3BhdXNlcGxheSI+PGE+PC9hPjwvZGl2PicpOw0KICAgICAgICANCiAgICAgICAgICAvLyBDT05UUk9MU0NPTlRBSU5FUjoNCiAgICAgICAgICBpZiAoc2xpZGVyLmNvbnRyb2xzQ29udGFpbmVyKSB7DQogICAgICAgICAgICBzbGlkZXIuY29udHJvbHNDb250YWluZXIuYXBwZW5kKHBhdXNlUGxheVNjYWZmb2xkKTsNCiAgICAgICAgICAgIHNsaWRlci5wYXVzZVBsYXkgPSAkKCcuJyArIG5hbWVzcGFjZSArICdwYXVzZXBsYXkgYScsIHNsaWRlci5jb250cm9sc0NvbnRhaW5lcik7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNsaWRlci5hcHBlbmQocGF1c2VQbGF5U2NhZmZvbGQpOw0KICAgICAgICAgICAgc2xpZGVyLnBhdXNlUGxheSA9ICQoJy4nICsgbmFtZXNwYWNlICsgJ3BhdXNlcGxheSBhJywgc2xpZGVyKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBtZXRob2RzLnBhdXNlUGxheS51cGRhdGUoKHZhcnMuc2xpZGVzaG93KSA/IG5hbWVzcGFjZSArICdwYXVzZScgOiBuYW1lc3BhY2UgKyAncGxheScpOw0KDQogICAgICAgICAgc2xpZGVyLnBhdXNlUGxheS5iaW5kKGV2ZW50VHlwZSwgZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcyhuYW1lc3BhY2UgKyAncGF1c2UnKSkgew0KICAgICAgICAgICAgICBzbGlkZXIubWFudWFsUGF1c2UgPSB0cnVlOw0KICAgICAgICAgICAgICBzbGlkZXIubWFudWFsUGxheSA9IGZhbHNlOw0KICAgICAgICAgICAgICBzbGlkZXIucGF1c2UoKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIHNsaWRlci5tYW51YWxQYXVzZSA9IGZhbHNlOw0KICAgICAgICAgICAgICBzbGlkZXIubWFudWFsUGxheSA9IHRydWU7DQogICAgICAgICAgICAgIHNsaWRlci5wbGF5KCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogICAgICAgICAgLy8gUHJldmVudCBpT1MgY2xpY2sgZXZlbnQgYnVnDQogICAgICAgICAgaWYgKHRvdWNoKSB7DQogICAgICAgICAgICBzbGlkZXIucGF1c2VQbGF5LmJpbmQoImNsaWNrIHRvdWNoc3RhcnQiLCBmdW5jdGlvbihldmVudCkgew0KICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uKHN0YXRlKSB7DQogICAgICAgICAgKHN0YXRlID09PSAicGxheSIpID8gc2xpZGVyLnBhdXNlUGxheS5yZW1vdmVDbGFzcyhuYW1lc3BhY2UgKyAncGF1c2UnKS5hZGRDbGFzcyhuYW1lc3BhY2UgKyAncGxheScpLnRleHQodmFycy5wbGF5VGV4dCkgOiBzbGlkZXIucGF1c2VQbGF5LnJlbW92ZUNsYXNzKG5hbWVzcGFjZSArICdwbGF5JykuYWRkQ2xhc3MobmFtZXNwYWNlICsgJ3BhdXNlJykudGV4dCh2YXJzLnBhdXNlVGV4dCk7DQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICB0b3VjaDogZnVuY3Rpb24oKSB7DQogICAgICAgIHZhciBzdGFydFgsDQogICAgICAgICAgc3RhcnRZLA0KICAgICAgICAgIG9mZnNldCwNCiAgICAgICAgICBjd2lkdGgsDQogICAgICAgICAgZHgsDQogICAgICAgICAgc3RhcnRULA0KICAgICAgICAgIHNjcm9sbGluZyA9IGZhbHNlOw0KICAgICAgICAgICAgICANCiAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIG9uVG91Y2hTdGFydCwgZmFsc2UpOw0KICAgICAgICBmdW5jdGlvbiBvblRvdWNoU3RhcnQoZSkgew0KICAgICAgICAgIGlmIChzbGlkZXIuYW5pbWF0aW5nKSB7DQogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgfSBlbHNlIGlmIChlLnRvdWNoZXMubGVuZ3RoID09PSAxKSB7DQogICAgICAgICAgICBzbGlkZXIucGF1c2UoKTsNCiAgICAgICAgICAgIC8vIENBUk9VU0VMOiANCiAgICAgICAgICAgIGN3aWR0aCA9ICh2ZXJ0aWNhbCkgPyBzbGlkZXIuaCA6IHNsaWRlci4gdzsNCiAgICAgICAgICAgIHN0YXJ0VCA9IE51bWJlcihuZXcgRGF0ZSgpKTsNCiAgICAgICAgICAgIC8vIENBUk9VU0VMOg0KICAgICAgICAgICAgb2Zmc2V0ID0gKGNhcm91c2VsICYmIHJldmVyc2UgJiYgc2xpZGVyLmFuaW1hdGluZ1RvID09PSBzbGlkZXIubGFzdCkgPyAwIDoNCiAgICAgICAgICAgICAgICAgICAgIChjYXJvdXNlbCAmJiByZXZlcnNlKSA/IHNsaWRlci5saW1pdCAtICgoKHNsaWRlci5pdGVtVyArIHZhcnMuaXRlbU1hcmdpbikgKiBzbGlkZXIubW92ZSkgKiBzbGlkZXIuYW5pbWF0aW5nVG8pIDoNCiAgICAgICAgICAgICAgICAgICAgIChjYXJvdXNlbCAmJiBzbGlkZXIuY3VycmVudFNsaWRlID09PSBzbGlkZXIubGFzdCkgPyBzbGlkZXIubGltaXQgOg0KICAgICAgICAgICAgICAgICAgICAgKGNhcm91c2VsKSA/ICgoc2xpZGVyLml0ZW1XICsgdmFycy5pdGVtTWFyZ2luKSAqIHNsaWRlci5tb3ZlKSAqIHNsaWRlci5jdXJyZW50U2xpZGUgOiANCiAgICAgICAgICAgICAgICAgICAgIChyZXZlcnNlKSA/IChzbGlkZXIubGFzdCAtIHNsaWRlci5jdXJyZW50U2xpZGUgKyBzbGlkZXIuY2xvbmVPZmZzZXQpICogY3dpZHRoIDogKHNsaWRlci5jdXJyZW50U2xpZGUgKyBzbGlkZXIuY2xvbmVPZmZzZXQpICogY3dpZHRoOw0KICAgICAgICAgICAgc3RhcnRYID0gKHZlcnRpY2FsKSA/IGUudG91Y2hlc1swXS5wYWdlWSA6IGUudG91Y2hlc1swXS5wYWdlWDsNCiAgICAgICAgICAgIHN0YXJ0WSA9ICh2ZXJ0aWNhbCkgPyBlLnRvdWNoZXNbMF0ucGFnZVggOiBlLnRvdWNoZXNbMF0ucGFnZVk7DQoNCiAgICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIG9uVG91Y2hNb3ZlLCBmYWxzZSk7DQogICAgICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIG9uVG91Y2hFbmQsIGZhbHNlKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBvblRvdWNoTW92ZShlKSB7DQogICAgICAgICAgZHggPSAodmVydGljYWwpID8gc3RhcnRYIC0gZS50b3VjaGVzWzBdLnBhZ2VZIDogc3RhcnRYIC0gZS50b3VjaGVzWzBdLnBhZ2VYOw0KICAgICAgICAgIHNjcm9sbGluZyA9ICh2ZXJ0aWNhbCkgPyAoTWF0aC5hYnMoZHgpIDwgTWF0aC5hYnMoZS50b3VjaGVzWzBdLnBhZ2VYIC0gc3RhcnRZKSkgOiAoTWF0aC5hYnMoZHgpIDwgTWF0aC5hYnMoZS50b3VjaGVzWzBdLnBhZ2VZIC0gc3RhcnRZKSk7DQogICAgICAgICAgDQogICAgICAgICAgaWYgKCFzY3JvbGxpbmcgfHwgTnVtYmVyKG5ldyBEYXRlKCkpIC0gc3RhcnRUID4gNTAwKSB7DQogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICBpZiAoIWZhZGUgJiYgc2xpZGVyLnRyYW5zaXRpb25zKSB7DQogICAgICAgICAgICAgIGlmICghdmFycy5hbmltYXRpb25Mb29wKSB7DQogICAgICAgICAgICAgICAgZHggPSBkeC8oKHNsaWRlci5jdXJyZW50U2xpZGUgPT09IDAgJiYgZHggPCAwIHx8IHNsaWRlci5jdXJyZW50U2xpZGUgPT09IHNsaWRlci5sYXN0ICYmIGR4ID4gMCkgPyAoTWF0aC5hYnMoZHgpL2N3aWR0aCsyKSA6IDEpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHNsaWRlci5zZXRQcm9wcyhvZmZzZXQgKyBkeCwgInNldFRvdWNoIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBmdW5jdGlvbiBvblRvdWNoRW5kKGUpIHsNCiAgICAgICAgICAvLyBmaW5pc2ggdGhlIHRvdWNoIGJ5IHVuZG9pbmcgdGhlIHRvdWNoIHNlc3Npb24NCiAgICAgICAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBvblRvdWNoTW92ZSwgZmFsc2UpOw0KICAgICAgICAgIA0KICAgICAgICAgIGlmIChzbGlkZXIuYW5pbWF0aW5nVG8gPT09IHNsaWRlci5jdXJyZW50U2xpZGUgJiYgIXNjcm9sbGluZyAmJiAhKGR4ID09PSBudWxsKSkgew0KICAgICAgICAgICAgdmFyIHVwZGF0ZUR4ID0gKHJldmVyc2UpID8gLWR4IDogZHgsDQogICAgICAgICAgICAgICAgdGFyZ2V0ID0gKHVwZGF0ZUR4ID4gMCkgPyBzbGlkZXIuZ2V0VGFyZ2V0KCduZXh0JykgOiBzbGlkZXIuZ2V0VGFyZ2V0KCdwcmV2Jyk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIChzbGlkZXIuY2FuQWR2YW5jZSh0YXJnZXQpICYmIChOdW1iZXIobmV3IERhdGUoKSkgLSBzdGFydFQgPCA1NTAgJiYgTWF0aC5hYnModXBkYXRlRHgpID4gNTAgfHwgTWF0aC5hYnModXBkYXRlRHgpID4gY3dpZHRoLzIpKSB7DQogICAgICAgICAgICAgIHNsaWRlci5mbGV4QW5pbWF0ZSh0YXJnZXQsIHZhcnMucGF1c2VPbkFjdGlvbik7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICBpZiAoIWZhZGUpIHNsaWRlci5mbGV4QW5pbWF0ZShzbGlkZXIuY3VycmVudFNsaWRlLCB2YXJzLnBhdXNlT25BY3Rpb24sIHRydWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIG9uVG91Y2hFbmQsIGZhbHNlKTsNCiAgICAgICAgICBzdGFydFggPSBudWxsOw0KICAgICAgICAgIHN0YXJ0WSA9IG51bGw7DQogICAgICAgICAgZHggPSBudWxsOw0KICAgICAgICAgIG9mZnNldCA9IG51bGw7DQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICByZXNpemU6IGZ1bmN0aW9uKCkgew0KICAgICAgICBpZiAoIXNsaWRlci5hbmltYXRpbmcgJiYgc2xpZGVyLmlzKCc6dmlzaWJsZScpKSB7DQogICAgICAgICAgaWYgKCFjYXJvdXNlbCkgc2xpZGVyLmRvTWF0aCgpOw0KICAgICAgICAgIA0KICAgICAgICAgIGlmIChmYWRlKSB7DQogICAgICAgICAgICAvLyBTTU9PVEggSEVJR0hUOg0KICAgICAgICAgICAgbWV0aG9kcy5zbW9vdGhIZWlnaHQoKTsNCiAgICAgICAgICB9IGVsc2UgaWYgKGNhcm91c2VsKSB7IC8vQ0FST1VTRUw6DQogICAgICAgICAgICBzbGlkZXIuc2xpZGVzLndpZHRoKHNsaWRlci5jb21wdXRlZFcpOw0KICAgICAgICAgICAgc2xpZGVyLnVwZGF0ZShzbGlkZXIucGFnaW5nQ291bnQpOw0KICAgICAgICAgICAgc2xpZGVyLnNldFByb3BzKCk7DQogICAgICAgICAgfQ0KICAgICAgICAgIGVsc2UgaWYgKHZlcnRpY2FsKSB7IC8vVkVSVElDQUw6DQogICAgICAgICAgICBzbGlkZXIudmlld3BvcnQuaGVpZ2h0KHNsaWRlci5oKTsNCiAgICAgICAgICAgIHNsaWRlci5zZXRQcm9wcyhzbGlkZXIuaCwgInNldFRvdGFsIik7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIFNNT09USCBIRUlHSFQ6DQogICAgICAgICAgICBpZiAodmFycy5zbW9vdGhIZWlnaHQpIG1ldGhvZHMuc21vb3RoSGVpZ2h0KCk7DQogICAgICAgICAgICBzbGlkZXIubmV3U2xpZGVzLndpZHRoKHNsaWRlci5jb21wdXRlZFcpOw0KICAgICAgICAgICAgc2xpZGVyLnNldFByb3BzKHNsaWRlci5jb21wdXRlZFcsICJzZXRUb3RhbCIpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICAgIHNtb290aEhlaWdodDogZnVuY3Rpb24oZHVyKSB7DQogICAgICAgIGlmICghdmVydGljYWwgfHwgZmFkZSkgew0KICAgICAgICAgIHZhciAkb2JqID0gKGZhZGUpID8gc2xpZGVyIDogc2xpZGVyLnZpZXdwb3J0Ow0KICAgICAgICAgIChkdXIpID8gJG9iai5hbmltYXRlKHsiaGVpZ2h0Ijogc2xpZGVyLnNsaWRlcy5lcShzbGlkZXIuYW5pbWF0aW5nVG8pLmhlaWdodCgpfSwgZHVyKSA6ICRvYmouaGVpZ2h0KHNsaWRlci5zbGlkZXMuZXEoc2xpZGVyLmFuaW1hdGluZ1RvKS5oZWlnaHQoKSk7DQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICBzeW5jOiBmdW5jdGlvbihhY3Rpb24pIHsNCiAgICAgICAgdmFyICRvYmogPSAkKHZhcnMuc3luYykuZGF0YSgiZmxleHNsaWRlciIpLA0KICAgICAgICAgICAgdGFyZ2V0ID0gc2xpZGVyLmFuaW1hdGluZ1RvOw0KICAgICAgICANCiAgICAgICAgc3dpdGNoIChhY3Rpb24pIHsNCiAgICAgICAgICBjYXNlICJhbmltYXRlIjogJG9iai5mbGV4QW5pbWF0ZSh0YXJnZXQsIHZhcnMucGF1c2VPbkFjdGlvbiwgZmFsc2UsIHRydWUpOyBicmVhazsNCiAgICAgICAgICBjYXNlICJwbGF5IjogaWYgKCEkb2JqLnBsYXlpbmcgJiYgISRvYmouYXNOYXYpIHsgJG9iai5wbGF5KCk7IH0gYnJlYWs7DQogICAgICAgICAgY2FzZSAicGF1c2UiOiAkb2JqLnBhdXNlKCk7IGJyZWFrOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIA0KICAgIC8vIHB1YmxpYyBtZXRob2RzDQogICAgc2xpZGVyLmZsZXhBbmltYXRlID0gZnVuY3Rpb24odGFyZ2V0LCBwYXVzZSwgb3ZlcnJpZGUsIHdpdGhTeW5jLCBmcm9tTmF2KSB7DQogICAgICBpZiAoYXNOYXYgJiYgc2xpZGVyLnBhZ2luZ0NvdW50ID09PSAxKSBzbGlkZXIuZGlyZWN0aW9uID0gKHNsaWRlci5jdXJyZW50SXRlbSA8IHRhcmdldCkgPyAibmV4dCIgOiAicHJldiI7DQogICAgICANCiAgICAgIGlmICghc2xpZGVyLmFuaW1hdGluZyAmJiAoc2xpZGVyLmNhbkFkdmFuY2UodGFyZ2V0LCBmcm9tTmF2KSB8fCBvdmVycmlkZSkgJiYgc2xpZGVyLmlzKCI6dmlzaWJsZSIpKSB7DQogICAgICAgIGlmIChhc05hdiAmJiB3aXRoU3luYykgew0KICAgICAgICAgIHZhciBtYXN0ZXIgPSAkKHZhcnMuYXNOYXZGb3IpLmRhdGEoJ2ZsZXhzbGlkZXInKTsNCiAgICAgICAgICBzbGlkZXIuYXRFbmQgPSB0YXJnZXQgPT09IDAgfHwgdGFyZ2V0ID09PSBzbGlkZXIuY291bnQgLSAxOw0KICAgICAgICAgIG1hc3Rlci5mbGV4QW5pbWF0ZSh0YXJnZXQsIHRydWUsIGZhbHNlLCB0cnVlLCBmcm9tTmF2KTsNCiAgICAgICAgICBzbGlkZXIuZGlyZWN0aW9uID0gKHNsaWRlci5jdXJyZW50SXRlbSA8IHRhcmdldCkgPyAibmV4dCIgOiAicHJldiI7DQogICAgICAgICAgbWFzdGVyLmRpcmVjdGlvbiA9IHNsaWRlci5kaXJlY3Rpb247DQogICAgICAgICAgDQogICAgICAgICAgaWYgKE1hdGguY2VpbCgodGFyZ2V0ICsgMSkvc2xpZGVyLnZpc2libGUpIC0gMSAhPT0gc2xpZGVyLmN1cnJlbnRTbGlkZSAmJiB0YXJnZXQgIT09IDApIHsNCiAgICAgICAgICAgIHNsaWRlci5jdXJyZW50SXRlbSA9IHRhcmdldDsNCiAgICAgICAgICAgIHNsaWRlci5zbGlkZXMucmVtb3ZlQ2xhc3MobmFtZXNwYWNlICsgImFjdGl2ZS1zbGlkZSIpLmVxKHRhcmdldCkuYWRkQ2xhc3MobmFtZXNwYWNlICsgImFjdGl2ZS1zbGlkZSIpOw0KICAgICAgICAgICAgdGFyZ2V0ID0gTWF0aC5mbG9vcih0YXJnZXQvc2xpZGVyLnZpc2libGUpOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBzbGlkZXIuY3VycmVudEl0ZW0gPSB0YXJnZXQ7DQogICAgICAgICAgICBzbGlkZXIuc2xpZGVzLnJlbW92ZUNsYXNzKG5hbWVzcGFjZSArICJhY3RpdmUtc2xpZGUiKS5lcSh0YXJnZXQpLmFkZENsYXNzKG5hbWVzcGFjZSArICJhY3RpdmUtc2xpZGUiKTsNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHNsaWRlci5hbmltYXRpbmcgPSB0cnVlOw0KICAgICAgICBzbGlkZXIuYW5pbWF0aW5nVG8gPSB0YXJnZXQ7DQogICAgICAgIC8vIEFQSTogYmVmb3JlKCkgYW5pbWF0aW9uIENhbGxiYWNrDQogICAgICAgIHZhcnMuYmVmb3JlKHNsaWRlcik7DQogICAgICAgIA0KICAgICAgICAvLyBTTElERVNIT1c6DQogICAgICAgIGlmIChwYXVzZSkgc2xpZGVyLnBhdXNlKCk7DQogICAgICAgIA0KICAgICAgICAvLyBTWU5DOg0KICAgICAgICBpZiAoc2xpZGVyLnN5bmNFeGlzdHMgJiYgIWZyb21OYXYpIG1ldGhvZHMuc3luYygiYW5pbWF0ZSIpOw0KICAgICAgICANCiAgICAgICAgLy8gQ09OVFJPTE5BVg0KICAgICAgICBpZiAodmFycy5jb250cm9sTmF2KSBtZXRob2RzLmNvbnRyb2xOYXYuYWN0aXZlKCk7DQogICAgICAgIA0KICAgICAgICAvLyAhQ0FST1VTRUw6DQogICAgICAgIC8vIENBTkRJREFURTogc2xpZGUgYWN0aXZlIGNsYXNzIChmb3IgYWRkL3JlbW92ZSBzbGlkZSkNCiAgICAgICAgaWYgKCFjYXJvdXNlbCkgc2xpZGVyLnNsaWRlcy5yZW1vdmVDbGFzcyhuYW1lc3BhY2UgKyAnYWN0aXZlLXNsaWRlJykuZXEodGFyZ2V0KS5hZGRDbGFzcyhuYW1lc3BhY2UgKyAnYWN0aXZlLXNsaWRlJyk7DQogICAgICAgIA0KICAgICAgICAvLyBJTkZJTklURSBMT09QOg0KICAgICAgICAvLyBDQU5ESURBVEU6IGF0RW5kDQogICAgICAgIHNsaWRlci5hdEVuZCA9IHRhcmdldCA9PT0gMCB8fCB0YXJnZXQgPT09IHNsaWRlci5sYXN0Ow0KICAgICAgICANCiAgICAgICAgLy8gRElSRUNUSU9OTkFWOg0KICAgICAgICBpZiAodmFycy5kaXJlY3Rpb25OYXYpIG1ldGhvZHMuZGlyZWN0aW9uTmF2LnVwZGF0ZSgpOw0KICAgICAgICANCiAgICAgICAgaWYgKHRhcmdldCA9PT0gc2xpZGVyLmxhc3QpIHsNCiAgICAgICAgICAvLyBBUEk6IGVuZCgpIG9mIGN5Y2xlIENhbGxiYWNrDQogICAgICAgICAgdmFycy5lbmQoc2xpZGVyKTsNCiAgICAgICAgICAvLyBTTElERVNIT1cgJiYgIUlORklOSVRFIExPT1A6DQogICAgICAgICAgaWYgKCF2YXJzLmFuaW1hdGlvbkxvb3ApIHNsaWRlci5wYXVzZSgpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBTTElERToNCiAgICAgICAgaWYgKCFmYWRlKSB7DQogICAgICAgICAgdmFyIGRpbWVuc2lvbiA9ICh2ZXJ0aWNhbCkgPyBzbGlkZXIuc2xpZGVzLmZpbHRlcignOmZpcnN0JykuaGVpZ2h0KCkgOiBzbGlkZXIuY29tcHV0ZWRXLA0KICAgICAgICAgICAgICBtYXJnaW4sIHNsaWRlU3RyaW5nLCBjYWxjTmV4dDsNCiAgICAgICAgICANCiAgICAgICAgICAvLyBJTkZJTklURSBMT09QIC8gUkVWRVJTRToNCiAgICAgICAgICBpZiAoY2Fyb3VzZWwpIHsNCiAgICAgICAgICAgIG1hcmdpbiA9ICh2YXJzLml0ZW1XaWR0aCA+IHNsaWRlci53KSA/IHZhcnMuaXRlbU1hcmdpbiAqIDIgOiB2YXJzLml0ZW1NYXJnaW47DQogICAgICAgICAgICBjYWxjTmV4dCA9ICgoc2xpZGVyLml0ZW1XICsgbWFyZ2luKSAqIHNsaWRlci5tb3ZlKSAqIHNsaWRlci5hbmltYXRpbmdUbzsNCiAgICAgICAgICAgIHNsaWRlU3RyaW5nID0gKGNhbGNOZXh0ID4gc2xpZGVyLmxpbWl0ICYmIHNsaWRlci52aXNpYmxlICE9PSAxKSA/IHNsaWRlci5saW1pdCA6IGNhbGNOZXh0Ow0KICAgICAgICAgIH0gZWxzZSBpZiAoc2xpZGVyLmN1cnJlbnRTbGlkZSA9PT0gMCAmJiB0YXJnZXQgPT09IHNsaWRlci5jb3VudCAtIDEgJiYgdmFycy5hbmltYXRpb25Mb29wICYmIHNsaWRlci5kaXJlY3Rpb24gIT09ICJuZXh0Iikgew0KICAgICAgICAgICAgc2xpZGVTdHJpbmcgPSAocmV2ZXJzZSkgPyAoc2xpZGVyLmNvdW50ICsgc2xpZGVyLmNsb25lT2Zmc2V0KSAqIGRpbWVuc2lvbiA6IDA7DQogICAgICAgICAgfSBlbHNlIGlmIChzbGlkZXIuY3VycmVudFNsaWRlID09PSBzbGlkZXIubGFzdCAmJiB0YXJnZXQgPT09IDAgJiYgdmFycy5hbmltYXRpb25Mb29wICYmIHNsaWRlci5kaXJlY3Rpb24gIT09ICJwcmV2Iikgew0KICAgICAgICAgICAgc2xpZGVTdHJpbmcgPSAocmV2ZXJzZSkgPyAwIDogKHNsaWRlci5jb3VudCArIDEpICogZGltZW5zaW9uOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBzbGlkZVN0cmluZyA9IChyZXZlcnNlKSA/ICgoc2xpZGVyLmNvdW50IC0gMSkgLSB0YXJnZXQgKyBzbGlkZXIuY2xvbmVPZmZzZXQpICogZGltZW5zaW9uIDogKHRhcmdldCArIHNsaWRlci5jbG9uZU9mZnNldCkgKiBkaW1lbnNpb247DQogICAgICAgICAgfQ0KICAgICAgICAgIHNsaWRlci5zZXRQcm9wcyhzbGlkZVN0cmluZywgIiIsIHZhcnMuYW5pbWF0aW9uU3BlZWQpOw0KICAgICAgICAgIGlmIChzbGlkZXIudHJhbnNpdGlvbnMpIHsNCiAgICAgICAgICAgIGlmICghdmFycy5hbmltYXRpb25Mb29wIHx8ICFzbGlkZXIuYXRFbmQpIHsNCiAgICAgICAgICAgICAgc2xpZGVyLmFuaW1hdGluZyA9IGZhbHNlOw0KICAgICAgICAgICAgICBzbGlkZXIuY3VycmVudFNsaWRlID0gc2xpZGVyLmFuaW1hdGluZ1RvOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2xpZGVyLmNvbnRhaW5lci51bmJpbmQoIndlYmtpdFRyYW5zaXRpb25FbmQgdHJhbnNpdGlvbmVuZCIpOw0KICAgICAgICAgICAgc2xpZGVyLmNvbnRhaW5lci5iaW5kKCJ3ZWJraXRUcmFuc2l0aW9uRW5kIHRyYW5zaXRpb25lbmQiLCBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgc2xpZGVyLndyYXB1cChkaW1lbnNpb24pOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNsaWRlci5jb250YWluZXIuYW5pbWF0ZShzbGlkZXIuYXJncywgdmFycy5hbmltYXRpb25TcGVlZCwgdmFycy5lYXNpbmcsIGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgIHNsaWRlci53cmFwdXAoZGltZW5zaW9uKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsgLy8gRkFERToNCiAgICAgICAgICBpZiAoIXRvdWNoKSB7DQogICAgICAgICAgICBzbGlkZXIuc2xpZGVzLmVxKHNsaWRlci5jdXJyZW50U2xpZGUpLmZhZGVPdXQodmFycy5hbmltYXRpb25TcGVlZCwgdmFycy5lYXNpbmcpOw0KICAgICAgICAgICAgc2xpZGVyLnNsaWRlcy5lcSh0YXJnZXQpLmZhZGVJbih2YXJzLmFuaW1hdGlvblNwZWVkLCB2YXJzLmVhc2luZywgc2xpZGVyLndyYXB1cCk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNsaWRlci5zbGlkZXMuZXEoc2xpZGVyLmN1cnJlbnRTbGlkZSkuY3NzKHsgIm9wYWNpdHkiOiAwLCAiekluZGV4IjogMSB9KTsNCiAgICAgICAgICAgIHNsaWRlci5zbGlkZXMuZXEodGFyZ2V0KS5jc3MoeyAib3BhY2l0eSI6IDEsICJ6SW5kZXgiOiAyIH0pOw0KICAgICAgICAgICAgc2xpZGVyLmFuaW1hdGluZyA9IGZhbHNlOw0KICAgICAgICAgICAgc2xpZGVyLmN1cnJlbnRTbGlkZSA9IHNsaWRlci5hbmltYXRpbmdUbzsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgLy8gU01PT1RIIEhFSUdIVDoNCiAgICAgICAgaWYgKHZhcnMuc21vb3RoSGVpZ2h0KSBtZXRob2RzLnNtb290aEhlaWdodCh2YXJzLmFuaW1hdGlvblNwZWVkKTsNCiAgICAgIH0NCiAgICB9IA0KICAgIHNsaWRlci53cmFwdXAgPSBmdW5jdGlvbihkaW1lbnNpb24pIHsNCiAgICAgIC8vIFNMSURFOg0KICAgICAgaWYgKCFmYWRlICYmICFjYXJvdXNlbCkgew0KICAgICAgICBpZiAoc2xpZGVyLmN1cnJlbnRTbGlkZSA9PT0gMCAmJiBzbGlkZXIuYW5pbWF0aW5nVG8gPT09IHNsaWRlci5sYXN0ICYmIHZhcnMuYW5pbWF0aW9uTG9vcCkgew0KICAgICAgICAgIHNsaWRlci5zZXRQcm9wcyhkaW1lbnNpb24sICJqdW1wRW5kIik7DQogICAgICAgIH0gZWxzZSBpZiAoc2xpZGVyLmN1cnJlbnRTbGlkZSA9PT0gc2xpZGVyLmxhc3QgJiYgc2xpZGVyLmFuaW1hdGluZ1RvID09PSAwICYmIHZhcnMuYW5pbWF0aW9uTG9vcCkgew0KICAgICAgICAgIHNsaWRlci5zZXRQcm9wcyhkaW1lbnNpb24sICJqdW1wU3RhcnQiKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgc2xpZGVyLmFuaW1hdGluZyA9IGZhbHNlOw0KICAgICAgc2xpZGVyLmN1cnJlbnRTbGlkZSA9IHNsaWRlci5hbmltYXRpbmdUbzsNCiAgICAgIC8vIEFQSTogYWZ0ZXIoKSBhbmltYXRpb24gQ2FsbGJhY2sNCiAgICAgIHZhcnMuYWZ0ZXIoc2xpZGVyKTsNCiAgICB9DQogICAgDQogICAgLy8gU0xJREVTSE9XOg0KICAgIHNsaWRlci5hbmltYXRlU2xpZGVzID0gZnVuY3Rpb24oKSB7DQogICAgICBpZiAoIXNsaWRlci5hbmltYXRpbmcpIHNsaWRlci5mbGV4QW5pbWF0ZShzbGlkZXIuZ2V0VGFyZ2V0KCJuZXh0IikpOw0KICAgIH0NCiAgICAvLyBTTElERVNIT1c6DQogICAgc2xpZGVyLnBhdXNlID0gZnVuY3Rpb24oKSB7DQogICAgICBjbGVhckludGVydmFsKHNsaWRlci5hbmltYXRlZFNsaWRlcyk7DQogICAgICBzbGlkZXIucGxheWluZyA9IGZhbHNlOw0KICAgICAgLy8gUEFVU0VQTEFZOg0KICAgICAgaWYgKHZhcnMucGF1c2VQbGF5KSBtZXRob2RzLnBhdXNlUGxheS51cGRhdGUoInBsYXkiKTsNCiAgICAgIC8vIFNZTkM6DQogICAgICBpZiAoc2xpZGVyLnN5bmNFeGlzdHMpIG1ldGhvZHMuc3luYygicGF1c2UiKTsNCiAgICB9DQogICAgLy8gU0xJREVTSE9XOg0KICAgIHNsaWRlci5wbGF5ID0gZnVuY3Rpb24oKSB7DQogICAgICBzbGlkZXIuYW5pbWF0ZWRTbGlkZXMgPSBzZXRJbnRlcnZhbChzbGlkZXIuYW5pbWF0ZVNsaWRlcywgdmFycy5zbGlkZXNob3dTcGVlZCk7DQogICAgICBzbGlkZXIucGxheWluZyA9IHRydWU7DQogICAgICAvLyBQQVVTRVBMQVk6DQogICAgICBpZiAodmFycy5wYXVzZVBsYXkpIG1ldGhvZHMucGF1c2VQbGF5LnVwZGF0ZSgicGF1c2UiKTsNCiAgICAgIC8vIFNZTkM6DQogICAgICBpZiAoc2xpZGVyLnN5bmNFeGlzdHMpIG1ldGhvZHMuc3luYygicGxheSIpOw0KICAgIH0NCiAgICBzbGlkZXIuY2FuQWR2YW5jZSA9IGZ1bmN0aW9uKHRhcmdldCwgZnJvbU5hdikgew0KICAgICAgLy8gQVNOQVY6DQogICAgICB2YXIgbGFzdCA9IChhc05hdikgPyBzbGlkZXIucGFnaW5nQ291bnQgLSAxIDogc2xpZGVyLmxhc3Q7DQogICAgICByZXR1cm4gKGZyb21OYXYpID8gdHJ1ZSA6DQogICAgICAgICAgICAgKGFzTmF2ICYmIHNsaWRlci5jdXJyZW50SXRlbSA9PT0gc2xpZGVyLmNvdW50IC0gMSAmJiB0YXJnZXQgPT09IDAgJiYgc2xpZGVyLmRpcmVjdGlvbiA9PT0gInByZXYiKSA/IHRydWUgOg0KICAgICAgICAgICAgIChhc05hdiAmJiBzbGlkZXIuY3VycmVudEl0ZW0gPT09IDAgJiYgdGFyZ2V0ID09PSBzbGlkZXIucGFnaW5nQ291bnQgLSAxICYmIHNsaWRlci5kaXJlY3Rpb24gIT09ICJuZXh0IikgPyBmYWxzZSA6DQogICAgICAgICAgICAgKHRhcmdldCA9PT0gc2xpZGVyLmN1cnJlbnRTbGlkZSAmJiAhYXNOYXYpID8gZmFsc2UgOg0KICAgICAgICAgICAgICh2YXJzLmFuaW1hdGlvbkxvb3ApID8gdHJ1ZSA6DQogICAgICAgICAgICAgKHNsaWRlci5hdEVuZCAmJiBzbGlkZXIuY3VycmVudFNsaWRlID09PSAwICYmIHRhcmdldCA9PT0gbGFzdCAmJiBzbGlkZXIuZGlyZWN0aW9uICE9PSAibmV4dCIpID8gZmFsc2UgOg0KICAgICAgICAgICAgIChzbGlkZXIuYXRFbmQgJiYgc2xpZGVyLmN1cnJlbnRTbGlkZSA9PT0gbGFzdCAmJiB0YXJnZXQgPT09IDAgJiYgc2xpZGVyLmRpcmVjdGlvbiA9PT0gIm5leHQiKSA/IGZhbHNlIDoNCiAgICAgICAgICAgICB0cnVlOw0KICAgIH0NCiAgICBzbGlkZXIuZ2V0VGFyZ2V0ID0gZnVuY3Rpb24oZGlyKSB7DQogICAgICBzbGlkZXIuZGlyZWN0aW9uID0gZGlyOyANCiAgICAgIGlmIChkaXIgPT09ICJuZXh0Iikgew0KICAgICAgICByZXR1cm4gKHNsaWRlci5jdXJyZW50U2xpZGUgPT09IHNsaWRlci5sYXN0KSA/IDAgOiBzbGlkZXIuY3VycmVudFNsaWRlICsgMTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAoc2xpZGVyLmN1cnJlbnRTbGlkZSA9PT0gMCkgPyBzbGlkZXIubGFzdCA6IHNsaWRlci5jdXJyZW50U2xpZGUgLSAxOw0KICAgICAgfQ0KICAgIH0NCiAgICANCiAgICAvLyBTTElERToNCiAgICBzbGlkZXIuc2V0UHJvcHMgPSBmdW5jdGlvbihwb3MsIHNwZWNpYWwsIGR1cikgew0KICAgICAgdmFyIHRhcmdldCA9IChmdW5jdGlvbigpIHsNCiAgICAgICAgdmFyIHBvc0NoZWNrID0gKHBvcykgPyBwb3MgOiAoKHNsaWRlci5pdGVtVyArIHZhcnMuaXRlbU1hcmdpbikgKiBzbGlkZXIubW92ZSkgKiBzbGlkZXIuYW5pbWF0aW5nVG8sDQogICAgICAgICAgICBwb3NDYWxjID0gKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICBpZiAoY2Fyb3VzZWwpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gKHNwZWNpYWwgPT09ICJzZXRUb3VjaCIpID8gcG9zIDoNCiAgICAgICAgICAgICAgICAgICAgICAgKHJldmVyc2UgJiYgc2xpZGVyLmFuaW1hdGluZ1RvID09PSBzbGlkZXIubGFzdCkgPyAwIDoNCiAgICAgICAgICAgICAgICAgICAgICAgKHJldmVyc2UpID8gc2xpZGVyLmxpbWl0IC0gKCgoc2xpZGVyLml0ZW1XICsgdmFycy5pdGVtTWFyZ2luKSAqIHNsaWRlci5tb3ZlKSAqIHNsaWRlci5hbmltYXRpbmdUbykgOg0KICAgICAgICAgICAgICAgICAgICAgICAoc2xpZGVyLmFuaW1hdGluZ1RvID09PSBzbGlkZXIubGFzdCkgPyBzbGlkZXIubGltaXQgOiBwb3NDaGVjazsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKHNwZWNpYWwpIHsNCiAgICAgICAgICAgICAgICAgIGNhc2UgInNldFRvdGFsIjogcmV0dXJuIChyZXZlcnNlKSA/ICgoc2xpZGVyLmNvdW50IC0gMSkgLSBzbGlkZXIuY3VycmVudFNsaWRlICsgc2xpZGVyLmNsb25lT2Zmc2V0KSAqIHBvcyA6IChzbGlkZXIuY3VycmVudFNsaWRlICsgc2xpZGVyLmNsb25lT2Zmc2V0KSAqIHBvczsNCiAgICAgICAgICAgICAgICAgIGNhc2UgInNldFRvdWNoIjogcmV0dXJuIChyZXZlcnNlKSA/IHBvcyA6IHBvczsNCiAgICAgICAgICAgICAgICAgIGNhc2UgImp1bXBFbmQiOiByZXR1cm4gKHJldmVyc2UpID8gcG9zIDogc2xpZGVyLmNvdW50ICogcG9zOw0KICAgICAgICAgICAgICAgICAgY2FzZSAianVtcFN0YXJ0IjogcmV0dXJuIChyZXZlcnNlKSA/IHNsaWRlci5jb3VudCAqIHBvcyA6IHBvczsNCiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHJldHVybiBwb3M7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KCkpOw0KICAgICAgICAgICAgcmV0dXJuIChwb3NDYWxjICogLTEpICsgInB4IjsNCiAgICAgICAgICB9KCkpOw0KDQogICAgICBpZiAoc2xpZGVyLnRyYW5zaXRpb25zKSB7DQogICAgICAgIHRhcmdldCA9ICh2ZXJ0aWNhbCkgPyAidHJhbnNsYXRlM2QoMCwiICsgdGFyZ2V0ICsgIiwwKSIgOiAidHJhbnNsYXRlM2QoIiArIHRhcmdldCArICIsMCwwKSI7DQogICAgICAgIGR1ciA9IChkdXIgIT09IHVuZGVmaW5lZCkgPyAoZHVyLzEwMDApICsgInMiIDogIjBzIjsNCiAgICAgICAgc2xpZGVyLmNvbnRhaW5lci5jc3MoIi0iICsgc2xpZGVyLnBmeCArICItdHJhbnNpdGlvbi1kdXJhdGlvbiIsIGR1cik7DQogICAgICB9DQogICAgICANCiAgICAgIHNsaWRlci5hcmdzW3NsaWRlci5wcm9wXSA9IHRhcmdldDsNCiAgICAgIGlmIChzbGlkZXIudHJhbnNpdGlvbnMgfHwgZHVyID09PSB1bmRlZmluZWQpIHNsaWRlci5jb250YWluZXIuY3NzKHNsaWRlci5hcmdzKTsNCiAgICB9DQogICAgDQogICAgc2xpZGVyLnNldHVwID0gZnVuY3Rpb24odHlwZSkgew0KICAgICAgLy8gU0xJREU6DQogICAgICBpZiAoIWZhZGUpIHsNCiAgICAgICAgdmFyIHNsaWRlck9mZnNldCwgYXJyOw0KICAgICAgICAgICAgDQogICAgICAgIGlmICh0eXBlID09PSAiaW5pdCIpIHsNCiAgICAgICAgICBzbGlkZXIudmlld3BvcnQgPSAkKCc8ZGl2IGNsYXNzPSInICsgbmFtZXNwYWNlICsgJ3ZpZXdwb3J0Ij48L2Rpdj4nKS5jc3MoeyJvdmVyZmxvdyI6ICJoaWRkZW4iLCAicG9zaXRpb24iOiAicmVsYXRpdmUifSkuYXBwZW5kVG8oc2xpZGVyKS5hcHBlbmQoc2xpZGVyLmNvbnRhaW5lcik7DQogICAgICAgICAgLy8gSU5GSU5JVEUgTE9PUDoNCiAgICAgICAgICBzbGlkZXIuY2xvbmVDb3VudCA9IDA7DQogICAgICAgICAgc2xpZGVyLmNsb25lT2Zmc2V0ID0gMDsNCiAgICAgICAgICAvLyBSRVZFUlNFOg0KICAgICAgICAgIGlmIChyZXZlcnNlKSB7DQogICAgICAgICAgICBhcnIgPSAkLm1ha2VBcnJheShzbGlkZXIuc2xpZGVzKS5yZXZlcnNlKCk7DQogICAgICAgICAgICBzbGlkZXIuc2xpZGVzID0gJChhcnIpOw0KICAgICAgICAgICAgc2xpZGVyLmNvbnRhaW5lci5lbXB0eSgpLmFwcGVuZChzbGlkZXIuc2xpZGVzKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgLy8gSU5GSU5JVEUgTE9PUCAmJiAhQ0FST1VTRUw6DQogICAgICAgIGlmICh2YXJzLmFuaW1hdGlvbkxvb3AgJiYgIWNhcm91c2VsKSB7DQogICAgICAgICAgc2xpZGVyLmNsb25lQ291bnQgPSAyOw0KICAgICAgICAgIHNsaWRlci5jbG9uZU9mZnNldCA9IDE7DQogICAgICAgICAgLy8gY2xlYXIgb3V0IG9sZCBjbG9uZXMNCiAgICAgICAgICBpZiAodHlwZSAhPT0gImluaXQiKSBzbGlkZXIuY29udGFpbmVyLmZpbmQoJy5jbG9uZScpLnJlbW92ZSgpOw0KICAgICAgICAgIHNsaWRlci5jb250YWluZXIuYXBwZW5kKHNsaWRlci5zbGlkZXMuZmlyc3QoKS5jbG9uZSgpLmFkZENsYXNzKCdjbG9uZScpKS5wcmVwZW5kKHNsaWRlci5zbGlkZXMubGFzdCgpLmNsb25lKCkuYWRkQ2xhc3MoJ2Nsb25lJykpOw0KICAgICAgICB9DQogICAgICAgIHNsaWRlci5uZXdTbGlkZXMgPSAkKHZhcnMuc2VsZWN0b3IsIHNsaWRlcik7DQogICAgICAgIA0KICAgICAgICBzbGlkZXJPZmZzZXQgPSAocmV2ZXJzZSkgPyBzbGlkZXIuY291bnQgLSAxIC0gc2xpZGVyLmN1cnJlbnRTbGlkZSArIHNsaWRlci5jbG9uZU9mZnNldCA6IHNsaWRlci5jdXJyZW50U2xpZGUgKyBzbGlkZXIuY2xvbmVPZmZzZXQ7DQogICAgICAgIC8vIFZFUlRJQ0FMOg0KICAgICAgICBpZiAodmVydGljYWwgJiYgIWNhcm91c2VsKSB7DQogICAgICAgICAgc2xpZGVyLmNvbnRhaW5lci5oZWlnaHQoKHNsaWRlci5jb3VudCArIHNsaWRlci5jbG9uZUNvdW50KSAqIDIwMCArICIlIikuY3NzKCJwb3NpdGlvbiIsICJhYnNvbHV0ZSIpLndpZHRoKCIxMDAlIik7DQogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpew0KICAgICAgICAgICAgc2xpZGVyLm5ld1NsaWRlcy5jc3MoeyJkaXNwbGF5IjogImJsb2NrIn0pOw0KICAgICAgICAgICAgc2xpZGVyLmRvTWF0aCgpOw0KICAgICAgICAgICAgc2xpZGVyLnZpZXdwb3J0LmhlaWdodChzbGlkZXIuaCk7DQogICAgICAgICAgICBzbGlkZXIuc2V0UHJvcHMoc2xpZGVyT2Zmc2V0ICogc2xpZGVyLmgsICJpbml0Iik7DQogICAgICAgICAgfSwgKHR5cGUgPT09ICJpbml0IikgPyAxMDAgOiAwKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBzbGlkZXIuY29udGFpbmVyLndpZHRoKChzbGlkZXIuY291bnQgKyBzbGlkZXIuY2xvbmVDb3VudCkgKiAyMDAgKyAiJSIpOw0KICAgICAgICAgIHNsaWRlci5zZXRQcm9wcyhzbGlkZXJPZmZzZXQgKiBzbGlkZXIuY29tcHV0ZWRXLCAiaW5pdCIpOw0KICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsNCiAgICAgICAgICAgIHNsaWRlci5kb01hdGgoKTsNCiAgICAgICAgICAgIHNsaWRlci5uZXdTbGlkZXMuY3NzKHsid2lkdGgiOiBzbGlkZXIuY29tcHV0ZWRXLCAiZmxvYXQiOiAibGVmdCIsICJkaXNwbGF5IjogImJsb2NrIn0pOw0KICAgICAgICAgICAgLy8gU01PT1RIIEhFSUdIVDoNCiAgICAgICAgICAgIGlmICh2YXJzLnNtb290aEhlaWdodCkgbWV0aG9kcy5zbW9vdGhIZWlnaHQoKTsNCiAgICAgICAgICB9LCAodHlwZSA9PT0gImluaXQiKSA/IDEwMCA6IDApOw0KICAgICAgICB9DQogICAgICB9IGVsc2UgeyAvLyBGQURFOiANCiAgICAgICAgc2xpZGVyLnNsaWRlcy5jc3MoeyJ3aWR0aCI6ICIxMDAlIiwgImZsb2F0IjogImxlZnQiLCAibWFyZ2luUmlnaHQiOiAiLTEwMCUiLCAicG9zaXRpb24iOiAicmVsYXRpdmUifSk7DQogICAgICAgIGlmICh0eXBlID09PSAiaW5pdCIpIHsNCiAgICAgICAgICBpZiAoIXRvdWNoKSB7DQogICAgICAgICAgICBzbGlkZXIuc2xpZGVzLmVxKHNsaWRlci5jdXJyZW50U2xpZGUpLmZhZGVJbih2YXJzLmFuaW1hdGlvblNwZWVkLCB2YXJzLmVhc2luZyk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNsaWRlci5zbGlkZXMuY3NzKHsgIm9wYWNpdHkiOiAwLCAiZGlzcGxheSI6ICJibG9jayIsICJ3ZWJraXRUcmFuc2l0aW9uIjogIm9wYWNpdHkgIiArIHZhcnMuYW5pbWF0aW9uU3BlZWQgLyAxMDAwICsgInMgZWFzZSIsICJ6SW5kZXgiOiAxIH0pLmVxKHNsaWRlci5jdXJyZW50U2xpZGUpLmNzcyh7ICJvcGFjaXR5IjogMSwgInpJbmRleCI6IDJ9KTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgLy8gU01PT1RIIEhFSUdIVDoNCiAgICAgICAgaWYgKHZhcnMuc21vb3RoSGVpZ2h0KSBtZXRob2RzLnNtb290aEhlaWdodCgpOw0KICAgICAgfQ0KICAgICAgLy8gIUNBUk9VU0VMOg0KICAgICAgLy8gQ0FORElEQVRFOiBhY3RpdmUgc2xpZGUNCiAgICAgIGlmICghY2Fyb3VzZWwpIHNsaWRlci5zbGlkZXMucmVtb3ZlQ2xhc3MobmFtZXNwYWNlICsgImFjdGl2ZS1zbGlkZSIpLmVxKHNsaWRlci5jdXJyZW50U2xpZGUpLmFkZENsYXNzKG5hbWVzcGFjZSArICJhY3RpdmUtc2xpZGUiKTsNCiAgICB9DQogICAgDQogICAgc2xpZGVyLmRvTWF0aCA9IGZ1bmN0aW9uKCkgew0KICAgICAgdmFyIHNsaWRlID0gc2xpZGVyLnNsaWRlcy5maXJzdCgpLA0KICAgICAgICAgIHNsaWRlTWFyZ2luID0gdmFycy5pdGVtTWFyZ2luLA0KICAgICAgICAgIG1pbkl0ZW1zID0gdmFycy5taW5JdGVtcywNCiAgICAgICAgICBtYXhJdGVtcyA9IHZhcnMubWF4SXRlbXM7DQogICAgICANCiAgICAgIHNsaWRlci53ID0gc2xpZGVyLndpZHRoKCk7DQogICAgICBzbGlkZXIuaCA9IHNsaWRlLmhlaWdodCgpOw0KICAgICAgc2xpZGVyLmJveFBhZGRpbmcgPSBzbGlkZS5vdXRlcldpZHRoKCkgLSBzbGlkZS53aWR0aCgpOw0KDQogICAgICAvLyBDQVJPVVNFTDoNCiAgICAgIGlmIChjYXJvdXNlbCkgew0KICAgICAgICBzbGlkZXIuaXRlbVQgPSB2YXJzLml0ZW1XaWR0aCArIHNsaWRlTWFyZ2luOw0KICAgICAgICBzbGlkZXIubWluVyA9IChtaW5JdGVtcykgPyBtaW5JdGVtcyAqIHNsaWRlci5pdGVtVCA6IHNsaWRlci53Ow0KICAgICAgICBzbGlkZXIubWF4VyA9IChtYXhJdGVtcykgPyBtYXhJdGVtcyAqIHNsaWRlci5pdGVtVCA6IHNsaWRlci53Ow0KICAgICAgICBzbGlkZXIuaXRlbVcgPSAoc2xpZGVyLm1pblcgPiBzbGlkZXIudykgPyAoc2xpZGVyLncgLSAoc2xpZGVNYXJnaW4gKiBtaW5JdGVtcykpL21pbkl0ZW1zIDoNCiAgICAgICAgICAgICAgICAgICAgICAgKHNsaWRlci5tYXhXIDwgc2xpZGVyLncpID8gKHNsaWRlci53IC0gKHNsaWRlTWFyZ2luICogbWF4SXRlbXMpKS9tYXhJdGVtcyA6DQogICAgICAgICAgICAgICAgICAgICAgICh2YXJzLml0ZW1XaWR0aCA+IHNsaWRlci53KSA/IHNsaWRlci53IDogdmFycy5pdGVtV2lkdGg7DQogICAgICAgIHNsaWRlci52aXNpYmxlID0gTWF0aC5mbG9vcihzbGlkZXIudy8oc2xpZGVyLml0ZW1XICsgc2xpZGVNYXJnaW4pKTsNCiAgICAgICAgc2xpZGVyLm1vdmUgPSAodmFycy5tb3ZlID4gMCAmJiB2YXJzLm1vdmUgPCBzbGlkZXIudmlzaWJsZSApID8gdmFycy5tb3ZlIDogc2xpZGVyLnZpc2libGU7DQogICAgICAgIHNsaWRlci5wYWdpbmdDb3VudCA9IE1hdGguY2VpbCgoKHNsaWRlci5jb3VudCAtIHNsaWRlci52aXNpYmxlKS9zbGlkZXIubW92ZSkgKyAxKTsNCiAgICAgICAgc2xpZGVyLmxhc3QgPSAgc2xpZGVyLnBhZ2luZ0NvdW50IC0gMTsNCiAgICAgICAgc2xpZGVyLmxpbWl0ID0gKHNsaWRlci5wYWdpbmdDb3VudCA9PT0gMSkgPyAwIDoNCiAgICAgICAgICAgICAgICAgICAgICAgKHZhcnMuaXRlbVdpZHRoID4gc2xpZGVyLncpID8gKChzbGlkZXIuaXRlbVcgKyAoc2xpZGVNYXJnaW4gKiAyKSkgKiBzbGlkZXIuY291bnQpIC0gc2xpZGVyLncgLSBzbGlkZU1hcmdpbiA6ICgoc2xpZGVyLml0ZW1XICsgc2xpZGVNYXJnaW4pICogc2xpZGVyLmNvdW50KSAtIHNsaWRlci53IC0gc2xpZGVNYXJnaW47DQogICAgICB9IGVsc2Ugew0KICAgICAgICBzbGlkZXIuaXRlbVcgPSBzbGlkZXIudzsNCiAgICAgICAgc2xpZGVyLnBhZ2luZ0NvdW50ID0gc2xpZGVyLmNvdW50Ow0KICAgICAgICBzbGlkZXIubGFzdCA9IHNsaWRlci5jb3VudCAtIDE7DQogICAgICB9DQogICAgICBzbGlkZXIuY29tcHV0ZWRXID0gc2xpZGVyLml0ZW1XIC0gc2xpZGVyLmJveFBhZGRpbmc7DQogICAgfQ0KICAgIA0KICAgIHNsaWRlci51cGRhdGUgPSBmdW5jdGlvbihwb3MsIGFjdGlvbikgew0KICAgICAgc2xpZGVyLmRvTWF0aCgpOw0KICAgICAgDQogICAgICAvLyB1cGRhdGUgY3VycmVudFNsaWRlIGFuZCBzbGlkZXIuYW5pbWF0aW5nVG8gaWYgbmVjZXNzYXJ5DQogICAgICBpZiAoIWNhcm91c2VsKSB7DQogICAgICAgIGlmIChwb3MgPCBzbGlkZXIuY3VycmVudFNsaWRlKSB7DQogICAgICAgICAgc2xpZGVyLmN1cnJlbnRTbGlkZSArPSAxOw0KICAgICAgICB9IGVsc2UgaWYgKHBvcyA8PSBzbGlkZXIuY3VycmVudFNsaWRlICYmIHBvcyAhPT0gMCkgew0KICAgICAgICAgIHNsaWRlci5jdXJyZW50U2xpZGUgLT0gMTsNCiAgICAgICAgfQ0KICAgICAgICBzbGlkZXIuYW5pbWF0aW5nVG8gPSBzbGlkZXIuY3VycmVudFNsaWRlOw0KICAgICAgfQ0KICAgICAgDQogICAgICAvLyB1cGRhdGUgY29udHJvbE5hdg0KICAgICAgaWYgKHZhcnMuY29udHJvbE5hdiAmJiAhc2xpZGVyLm1hbnVhbENvbnRyb2xzKSB7DQogICAgICAgIGlmICgoYWN0aW9uID09PSAiYWRkIiAmJiAhY2Fyb3VzZWwpIHx8IHNsaWRlci5wYWdpbmdDb3VudCA+IHNsaWRlci5jb250cm9sTmF2Lmxlbmd0aCkgew0KICAgICAgICAgIG1ldGhvZHMuY29udHJvbE5hdi51cGRhdGUoImFkZCIpOw0KICAgICAgICB9IGVsc2UgaWYgKChhY3Rpb24gPT09ICJyZW1vdmUiICYmICFjYXJvdXNlbCkgfHwgc2xpZGVyLnBhZ2luZ0NvdW50IDwgc2xpZGVyLmNvbnRyb2xOYXYubGVuZ3RoKSB7DQogICAgICAgICAgaWYgKGNhcm91c2VsICYmIHNsaWRlci5jdXJyZW50U2xpZGUgPiBzbGlkZXIubGFzdCkgew0KICAgICAgICAgICAgc2xpZGVyLmN1cnJlbnRTbGlkZSAtPSAxOw0KICAgICAgICAgICAgc2xpZGVyLmFuaW1hdGluZ1RvIC09IDE7DQogICAgICAgICAgfQ0KICAgICAgICAgIG1ldGhvZHMuY29udHJvbE5hdi51cGRhdGUoInJlbW92ZSIsIHNsaWRlci5sYXN0KTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLy8gdXBkYXRlIGRpcmVjdGlvbk5hdg0KICAgICAgaWYgKHZhcnMuZGlyZWN0aW9uTmF2KSBtZXRob2RzLmRpcmVjdGlvbk5hdi51cGRhdGUoKTsNCiAgICAgIA0KICAgIH0NCiAgICANCiAgICBzbGlkZXIuYWRkU2xpZGUgPSBmdW5jdGlvbihvYmosIHBvcykgew0KICAgICAgdmFyICRvYmogPSAkKG9iaik7DQogICAgICANCiAgICAgIHNsaWRlci5jb3VudCArPSAxOw0KICAgICAgc2xpZGVyLmxhc3QgPSBzbGlkZXIuY291bnQgLSAxOw0KICAgICAgDQogICAgICAvLyBhcHBlbmQgbmV3IHNsaWRlDQogICAgICBpZiAodmVydGljYWwgJiYgcmV2ZXJzZSkgew0KICAgICAgICAocG9zICE9PSB1bmRlZmluZWQpID8gc2xpZGVyLnNsaWRlcy5lcShzbGlkZXIuY291bnQgLSBwb3MpLmFmdGVyKCRvYmopIDogc2xpZGVyLmNvbnRhaW5lci5wcmVwZW5kKCRvYmopOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgKHBvcyAhPT0gdW5kZWZpbmVkKSA/IHNsaWRlci5zbGlkZXMuZXEocG9zKS5iZWZvcmUoJG9iaikgOiBzbGlkZXIuY29udGFpbmVyLmFwcGVuZCgkb2JqKTsNCiAgICAgIH0NCiAgICAgIA0KICAgICAgLy8gdXBkYXRlIGN1cnJlbnRTbGlkZSwgYW5pbWF0aW5nVG8sIGNvbnRyb2xOYXYsIGFuZCBkaXJlY3Rpb25OYXYNCiAgICAgIHNsaWRlci51cGRhdGUocG9zLCAiYWRkIik7DQogICAgICANCiAgICAgIC8vIHVwZGF0ZSBzbGlkZXIuc2xpZGVzDQogICAgICBzbGlkZXIuc2xpZGVzID0gJCh2YXJzLnNlbGVjdG9yICsgJzpub3QoLmNsb25lKScsIHNsaWRlcik7DQogICAgICAvLyByZS1zZXR1cCB0aGUgc2xpZGVyIHRvIGFjY29tZGF0ZSBuZXcgc2xpZGUNCiAgICAgIHNsaWRlci5zZXR1cCgpOw0KICAgICAgDQogICAgICAvL0ZsZXhTbGlkZXI6IGFkZGVkKCkgQ2FsbGJhY2sNCiAgICAgIHZhcnMuYWRkZWQoc2xpZGVyKTsNCiAgICB9DQogICAgc2xpZGVyLnJlbW92ZVNsaWRlID0gZnVuY3Rpb24ob2JqKSB7DQogICAgICB2YXIgcG9zID0gKGlzTmFOKG9iaikpID8gc2xpZGVyLnNsaWRlcy5pbmRleCgkKG9iaikpIDogb2JqOw0KICAgICAgDQogICAgICAvLyB1cGRhdGUgY291bnQNCiAgICAgIHNsaWRlci5jb3VudCAtPSAxOw0KICAgICAgc2xpZGVyLmxhc3QgPSBzbGlkZXIuY291bnQgLSAxOw0KICAgICAgDQogICAgICAvLyByZW1vdmUgc2xpZGUNCiAgICAgIGlmIChpc05hTihvYmopKSB7DQogICAgICAgICQob2JqLCBzbGlkZXIuc2xpZGVzKS5yZW1vdmUoKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgICh2ZXJ0aWNhbCAmJiByZXZlcnNlKSA/IHNsaWRlci5zbGlkZXMuZXEoc2xpZGVyLmxhc3QpLnJlbW92ZSgpIDogc2xpZGVyLnNsaWRlcy5lcShvYmopLnJlbW92ZSgpOw0KICAgICAgfQ0KICAgICAgDQogICAgICAvLyB1cGRhdGUgY3VycmVudFNsaWRlLCBhbmltYXRpbmdUbywgY29udHJvbE5hdiwgYW5kIGRpcmVjdGlvbk5hdg0KICAgICAgc2xpZGVyLmRvTWF0aCgpOw0KICAgICAgc2xpZGVyLnVwZGF0ZShwb3MsICJyZW1vdmUiKTsNCiAgICAgIA0KICAgICAgLy8gdXBkYXRlIHNsaWRlci5zbGlkZXMNCiAgICAgIHNsaWRlci5zbGlkZXMgPSAkKHZhcnMuc2VsZWN0b3IgKyAnOm5vdCguY2xvbmUpJywgc2xpZGVyKTsNCiAgICAgIC8vIHJlLXNldHVwIHRoZSBzbGlkZXIgdG8gYWNjb21kYXRlIG5ldyBzbGlkZQ0KICAgICAgc2xpZGVyLnNldHVwKCk7DQogICAgICANCiAgICAgIC8vIEZsZXhTbGlkZXI6IHJlbW92ZWQoKSBDYWxsYmFjaw0KICAgICAgdmFycy5yZW1vdmVkKHNsaWRlcik7DQogICAgfQ0KICAgIA0KICAgIC8vRmxleFNsaWRlcjogSW5pdGlhbGl6ZQ0KICAgIG1ldGhvZHMuaW5pdCgpOw0KICB9DQogIA0KICAvL0ZsZXhTbGlkZXI6IERlZmF1bHQgU2V0dGluZ3MNCiAgJC5mbGV4c2xpZGVyLmRlZmF1bHRzID0gew0KICAgIG5hbWVzcGFjZTogImZsZXgtIiwgICAgICAgICAgICAgLy97TkVXfSBTdHJpbmc6IFByZWZpeCBzdHJpbmcgYXR0YWNoZWQgdG8gdGhlIGNsYXNzIG9mIGV2ZXJ5IGVsZW1lbnQgZ2VuZXJhdGVkIGJ5IHRoZSBwbHVnaW4NCiAgICBzZWxlY3RvcjogIi5zbGlkZXMgPiBsaSIsICAgICAgIC8ve05FV30gU2VsZWN0b3I6IE11c3QgbWF0Y2ggYSBzaW1wbGUgcGF0dGVybi4gJ3tjb250YWluZXJ9ID4ge3NsaWRlfScgLS0gSWdub3JlIHBhdHRlcm4gYXQgeW91ciBvd24gcGVyaWwNCiAgICBhbmltYXRpb246ICJmYWRlIiwgICAgICAgICAgICAgIC8vU3RyaW5nOiBTZWxlY3QgeW91ciBhbmltYXRpb24gdHlwZSwgImZhZGUiIG9yICJzbGlkZSINCiAgICBlYXNpbmc6ICJzd2luZyIsICAgICAgICAgICAgICAgLy97TkVXfSBTdHJpbmc6IERldGVybWluZXMgdGhlIGVhc2luZyBtZXRob2QgdXNlZCBpbiBqUXVlcnkgdHJhbnNpdGlvbnMuIGpRdWVyeSBlYXNpbmcgcGx1Z2luIGlzIHN1cHBvcnRlZCENCiAgICBkaXJlY3Rpb246ICJob3Jpem9udGFsIiwgICAgICAgIC8vU3RyaW5nOiBTZWxlY3QgdGhlIHNsaWRpbmcgZGlyZWN0aW9uLCAiaG9yaXpvbnRhbCIgb3IgInZlcnRpY2FsIg0KICAgIHJldmVyc2U6IGZhbHNlLCAgICAgICAgICAgICAgICAgLy97TkVXfSBCb29sZWFuOiBSZXZlcnNlIHRoZSBhbmltYXRpb24gZGlyZWN0aW9uDQogICAgYW5pbWF0aW9uTG9vcDogdHJ1ZSwgICAgICAgICAgICAgLy9Cb29sZWFuOiBTaG91bGQgdGhlIGFuaW1hdGlvbiBsb29wPyBJZiBmYWxzZSwgZGlyZWN0aW9uTmF2IHdpbGwgcmVjZWl2ZWQgImRpc2FibGUiIGNsYXNzZXMgYXQgZWl0aGVyIGVuZA0KICAgIHNtb290aEhlaWdodDogZmFsc2UsICAgICAgICAgICAgLy97TkVXfSBCb29sZWFuOiBBbGxvdyBoZWlnaHQgb2YgdGhlIHNsaWRlciB0byBhbmltYXRlIHNtb290aGx5IGluIGhvcml6b250YWwgbW9kZSAgDQogICAgc3RhcnRBdDogMCwgICAgICAgICAgICAgICAgICAgICAvL0ludGVnZXI6IFRoZSBzbGlkZSB0aGF0IHRoZSBzbGlkZXIgc2hvdWxkIHN0YXJ0IG9uLiBBcnJheSBub3RhdGlvbiAoMCA9IGZpcnN0IHNsaWRlKQ0KICAgIHNsaWRlc2hvdzogdHJ1ZSwgICAgICAgICAgICAgICAgLy9Cb29sZWFuOiBBbmltYXRlIHNsaWRlciBhdXRvbWF0aWNhbGx5DQogICAgc2xpZGVzaG93U3BlZWQ6IDcwMDAsICAgICAgICAgICAvL0ludGVnZXI6IFNldCB0aGUgc3BlZWQgb2YgdGhlIHNsaWRlc2hvdyBjeWNsaW5nLCBpbiBtaWxsaXNlY29uZHMNCiAgICBhbmltYXRpb25TcGVlZDogNjAwLCAgICAgICAgICAgIC8vSW50ZWdlcjogU2V0IHRoZSBzcGVlZCBvZiBhbmltYXRpb25zLCBpbiBtaWxsaXNlY29uZHMNCiAgICBpbml0RGVsYXk6IDAsICAgICAgICAgICAgICAgICAgIC8ve05FV30gSW50ZWdlcjogU2V0IGFuIGluaXRpYWxpemF0aW9uIGRlbGF5LCBpbiBtaWxsaXNlY29uZHMNCiAgICByYW5kb21pemU6IGZhbHNlLCAgICAgICAgICAgICAgIC8vQm9vbGVhbjogUmFuZG9taXplIHNsaWRlIG9yZGVyDQogICAgDQogICAgLy8gVXNhYmlsaXR5IGZlYXR1cmVzDQogICAgcGF1c2VPbkFjdGlvbjogdHJ1ZSwgICAgICAgICAgICAvL0Jvb2xlYW46IFBhdXNlIHRoZSBzbGlkZXNob3cgd2hlbiBpbnRlcmFjdGluZyB3aXRoIGNvbnRyb2wgZWxlbWVudHMsIGhpZ2hseSByZWNvbW1lbmRlZC4NCiAgICBwYXVzZU9uSG92ZXI6IGZhbHNlLCAgICAgICAgICAgIC8vQm9vbGVhbjogUGF1c2UgdGhlIHNsaWRlc2hvdyB3aGVuIGhvdmVyaW5nIG92ZXIgc2xpZGVyLCB0aGVuIHJlc3VtZSB3aGVuIG5vIGxvbmdlciBob3ZlcmluZw0KICAgIHVzZUNTUzogdHJ1ZSwgICAgICAgICAgICAgICAgICAgLy97TkVXfSBCb29sZWFuOiBTbGlkZXIgd2lsbCB1c2UgQ1NTMyB0cmFuc2l0aW9ucyBpZiBhdmFpbGFibGUNCiAgICB0b3VjaDogdHJ1ZSwgICAgICAgICAgICAgICAgICAgIC8ve05FV30gQm9vbGVhbjogQWxsb3cgdG91Y2ggc3dpcGUgbmF2aWdhdGlvbiBvZiB0aGUgc2xpZGVyIG9uIHRvdWNoLWVuYWJsZWQgZGV2aWNlcw0KICAgIHZpZGVvOiBmYWxzZSwgICAgICAgICAgICAgICAgICAgLy97TkVXfSBCb29sZWFuOiBJZiB1c2luZyB2aWRlbyBpbiB0aGUgc2xpZGVyLCB3aWxsIHByZXZlbnQgQ1NTMyAzRCBUcmFuc2Zvcm1zIHRvIGF2b2lkIGdyYXBoaWNhbCBnbGl0Y2hlcw0KICAgIA0KICAgIC8vIFByaW1hcnkgQ29udHJvbHMNCiAgICBjb250cm9sTmF2OiB0cnVlLCAgICAgICAgICAgICAgIC8vQm9vbGVhbjogQ3JlYXRlIG5hdmlnYXRpb24gZm9yIHBhZ2luZyBjb250cm9sIG9mIGVhY2ggY2xpZGU/IE5vdGU6IExlYXZlIHRydWUgZm9yIG1hbnVhbENvbnRyb2xzIHVzYWdlDQogICAgZGlyZWN0aW9uTmF2OiB0cnVlLCAgICAgICAgICAgICAvL0Jvb2xlYW46IENyZWF0ZSBuYXZpZ2F0aW9uIGZvciBwcmV2aW91cy9uZXh0IG5hdmlnYXRpb24/ICh0cnVlL2ZhbHNlKQ0KICAgIHByZXZUZXh0OiAiUHJldmlvdXMiLCAgICAgICAgICAgLy9TdHJpbmc6IFNldCB0aGUgdGV4dCBmb3IgdGhlICJwcmV2aW91cyIgZGlyZWN0aW9uTmF2IGl0ZW0NCiAgICBuZXh0VGV4dDogIk5leHQiLCAgICAgICAgICAgICAgIC8vU3RyaW5nOiBTZXQgdGhlIHRleHQgZm9yIHRoZSAibmV4dCIgZGlyZWN0aW9uTmF2IGl0ZW0NCiAgICANCiAgICAvLyBTZWNvbmRhcnkgTmF2aWdhdGlvbg0KICAgIGtleWJvYXJkOiB0cnVlLCAgICAgICAgICAgICAgICAgLy9Cb29sZWFuOiBBbGxvdyBzbGlkZXIgbmF2aWdhdGluZyB2aWEga2V5Ym9hcmQgbGVmdC9yaWdodCBrZXlzDQogICAgbXVsdGlwbGVLZXlib2FyZDogZmFsc2UsICAgICAgICAvL3tORVd9IEJvb2xlYW46IEFsbG93IGtleWJvYXJkIG5hdmlnYXRpb24gdG8gYWZmZWN0IG11bHRpcGxlIHNsaWRlcnMuIERlZmF1bHQgYmVoYXZpb3IgY3V0cyBvdXQga2V5Ym9hcmQgbmF2aWdhdGlvbiB3aXRoIG1vcmUgdGhhbiBvbmUgc2xpZGVyIHByZXNlbnQuDQogICAgbW91c2V3aGVlbDogZmFsc2UsICAgICAgICAgICAgICAvL3tVUERBVEVEfSBCb29sZWFuOiBSZXF1aXJlcyBqcXVlcnkubW91c2V3aGVlbC5qcyAoaHR0cHM6Ly9naXRodWIuY29tL2JyYW5kb25hYXJvbi9qcXVlcnktbW91c2V3aGVlbCkgLSBBbGxvd3Mgc2xpZGVyIG5hdmlnYXRpbmcgdmlhIG1vdXNld2hlZWwNCiAgICBwYXVzZVBsYXk6IGZhbHNlLCAgICAgICAgICAgICAgIC8vQm9vbGVhbjogQ3JlYXRlIHBhdXNlL3BsYXkgZHluYW1pYyBlbGVtZW50DQogICAgcGF1c2VUZXh0OiAiUGF1c2UiLCAgICAgICAgICAgICAvL1N0cmluZzogU2V0IHRoZSB0ZXh0IGZvciB0aGUgInBhdXNlIiBwYXVzZVBsYXkgaXRlbQ0KICAgIHBsYXlUZXh0OiAiUGxheSIsICAgICAgICAgICAgICAgLy9TdHJpbmc6IFNldCB0aGUgdGV4dCBmb3IgdGhlICJwbGF5IiBwYXVzZVBsYXkgaXRlbQ0KICAgIA0KICAgIC8vIFNwZWNpYWwgcHJvcGVydGllcw0KICAgIGNvbnRyb2xzQ29udGFpbmVyOiAiIiwgICAgICAgICAgLy97VVBEQVRFRH0galF1ZXJ5IE9iamVjdC9TZWxlY3RvcjogRGVjbGFyZSB3aGljaCBjb250YWluZXIgdGhlIG5hdmlnYXRpb24gZWxlbWVudHMgc2hvdWxkIGJlIGFwcGVuZGVkIHRvby4gRGVmYXVsdCBjb250YWluZXIgaXMgdGhlIEZsZXhTbGlkZXIgZWxlbWVudC4gRXhhbXBsZSB1c2Ugd291bGQgYmUgJCgiLmZsZXhzbGlkZXItY29udGFpbmVyIikuIFByb3BlcnR5IGlzIGlnbm9yZWQgaWYgZ2l2ZW4gZWxlbWVudCBpcyBub3QgZm91bmQuDQogICAgbWFudWFsQ29udHJvbHM6ICIiLCAgICAgICAgICAgICAvL3tVUERBVEVEfSBqUXVlcnkgT2JqZWN0L1NlbGVjdG9yOiBEZWNsYXJlIGN1c3RvbSBjb250cm9sIG5hdmlnYXRpb24uIEV4YW1wbGVzIHdvdWxkIGJlICQoIi5mbGV4LWNvbnRyb2wtbmF2IGxpIikgb3IgIiN0YWJzLW5hdiBsaSBpbWciLCBldGMuIFRoZSBudW1iZXIgb2YgZWxlbWVudHMgaW4geW91ciBjb250cm9sTmF2IHNob3VsZCBtYXRjaCB0aGUgbnVtYmVyIG9mIHNsaWRlcy90YWJzLg0KICAgIHN5bmM6ICIiLCAgICAgICAgICAgICAgICAgICAgICAgLy97TkVXfSBTZWxlY3RvcjogTWlycm9yIHRoZSBhY3Rpb25zIHBlcmZvcm1lZCBvbiB0aGlzIHNsaWRlciB3aXRoIGFub3RoZXIgc2xpZGVyLiBVc2Ugd2l0aCBjYXJlLg0KICAgIGFzTmF2Rm9yOiAiIiwgICAgICAgICAgICAgICAgICAgLy97TkVXfSBTZWxlY3RvcjogSW50ZXJuYWwgcHJvcGVydHkgZXhwb3NlZCBmb3IgdHVybmluZyB0aGUgc2xpZGVyIGludG8gYSB0aHVtYm5haWwgbmF2aWdhdGlvbiBmb3IgYW5vdGhlciBzbGlkZXINCiAgICANCiAgICAvLyBDYXJvdXNlbCBPcHRpb25zDQogICAgaXRlbVdpZHRoOiAwLCAgICAgICAgICAgICAgICAgICAvL3tORVd9IEludGVnZXI6IEJveC1tb2RlbCB3aWR0aCBvZiBpbmRpdmlkdWFsIGNhcm91c2VsIGl0ZW1zLCBpbmNsdWRpbmcgaG9yaXpvbnRhbCBib3JkZXJzIGFuZCBwYWRkaW5nLg0KICAgIGl0ZW1NYXJnaW46IDAsICAgICAgICAgICAgICAgICAgLy97TkVXfSBJbnRlZ2VyOiBNYXJnaW4gYmV0d2VlbiBjYXJvdXNlbCBpdGVtcy4NCiAgICBtaW5JdGVtczogNSwgICAgICAgICAgICAgICAgICAgIC8ve05FV30gSW50ZWdlcjogTWluaW11bSBudW1iZXIgb2YgY2Fyb3VzZWwgaXRlbXMgdGhhdCBzaG91bGQgYmUgdmlzaWJsZS4gSXRlbXMgd2lsbCByZXNpemUgZmx1aWRseSB3aGVuIGJlbG93IHRoaXMuDQogICAgbWF4SXRlbXM6IDUsICAgICAgICAgICAgICAgICAgICAvL3tORVd9IEludGVnZXI6IE1heG1pbXVtIG51bWJlciBvZiBjYXJvdXNlbCBpdGVtcyB0aGF0IHNob3VsZCBiZSB2aXNpYmxlLiBJdGVtcyB3aWxsIHJlc2l6ZSBmbHVpZGx5IHdoZW4gYWJvdmUgdGhpcyBsaW1pdC4NCiAgICBtb3ZlOiAwLCAgICAgICAgICAgICAgICAgICAgICAgIC8ve05FV30gSW50ZWdlcjogTnVtYmVyIG9mIGNhcm91c2VsIGl0ZW1zIHRoYXQgc2hvdWxkIG1vdmUgb24gYW5pbWF0aW9uLiBJZiAwLCBzbGlkZXIgd2lsbCBtb3ZlIGFsbCB2aXNpYmxlIGl0ZW1zLg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgLy8gQ2FsbGJhY2sgQVBJDQogICAgc3RhcnQ6IGZ1bmN0aW9uKCl7fSwgICAgICAgICAgICAvL0NhbGxiYWNrOiBmdW5jdGlvbihzbGlkZXIpIC0gRmlyZXMgd2hlbiB0aGUgc2xpZGVyIGxvYWRzIHRoZSBmaXJzdCBzbGlkZQ0KICAgIGJlZm9yZTogZnVuY3Rpb24oKXt9LCAgICAgICAgICAgLy9DYWxsYmFjazogZnVuY3Rpb24oc2xpZGVyKSAtIEZpcmVzIGFzeW5jaHJvbm91c2x5IHdpdGggZWFjaCBzbGlkZXIgYW5pbWF0aW9uDQogICAgYWZ0ZXI6IGZ1bmN0aW9uKCl7fSwgICAgICAgICAgICAvL0NhbGxiYWNrOiBmdW5jdGlvbihzbGlkZXIpIC0gRmlyZXMgYWZ0ZXIgZWFjaCBzbGlkZXIgYW5pbWF0aW9uIGNvbXBsZXRlcw0KICAgIGVuZDogZnVuY3Rpb24oKXt9LCAgICAgICAgICAgICAgLy9DYWxsYmFjazogZnVuY3Rpb24oc2xpZGVyKSAtIEZpcmVzIHdoZW4gdGhlIHNsaWRlciByZWFjaGVzIHRoZSBsYXN0IHNsaWRlIChhc3luY2hyb25vdXMpDQogICAgYWRkZWQ6IGZ1bmN0aW9uKCl7fSwgICAgICAgICAgICAvL3tORVd9IENhbGxiYWNrOiBmdW5jdGlvbihzbGlkZXIpIC0gRmlyZXMgYWZ0ZXIgYSBzbGlkZSBpcyBhZGRlZA0KICAgIHJlbW92ZWQ6IGZ1bmN0aW9uKCl7fSAgICAgICAgICAgLy97TkVXfSBDYWxsYmFjazogZnVuY3Rpb24oc2xpZGVyKSAtIEZpcmVzIGFmdGVyIGEgc2xpZGUgaXMgcmVtb3ZlZA0KICB9DQoNCg0KICAvL0ZsZXhTbGlkZXI6IFBsdWdpbiBGdW5jdGlvbg0KICAkLmZuLmZsZXhzbGlkZXIgPSBmdW5jdGlvbihvcHRpb25zKSB7DQogICAgaWYgKG9wdGlvbnMgPT09IHVuZGVmaW5lZCkgb3B0aW9ucyA9IHt9Ow0KICAgIA0KICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gIm9iamVjdCIpIHsNCiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7DQogICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyksDQogICAgICAgICAgICBzZWxlY3RvciA9IChvcHRpb25zLnNlbGVjdG9yKSA/IG9wdGlvbnMuc2VsZWN0b3IgOiAiLnNsaWRlcyA+IGxpIiwNCiAgICAgICAgICAgICRzbGlkZXMgPSAkdGhpcy5maW5kKHNlbGVjdG9yKTsNCg0KICAgICAgICBpZiAoJHNsaWRlcy5sZW5ndGggPT09IDEpIHsNCiAgICAgICAgICAkc2xpZGVzLmZhZGVJbig0MDApOw0KICAgICAgICAgIGlmIChvcHRpb25zLnN0YXJ0KSBvcHRpb25zLnN0YXJ0KCR0aGlzKTsNCiAgICAgICAgfSBlbHNlIGlmICgkdGhpcy5kYXRhKCdmbGV4c2xpZGVyJykgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgIG5ldyAkLmZsZXhzbGlkZXIodGhpcywgb3B0aW9ucyk7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH0gZWxzZSB7DQogICAgICAvLyBIZWxwZXIgc3RyaW5ncyB0byBxdWlja2x5IHBlcmZvcm0gZnVuY3Rpb25zIG9uIHRoZSBzbGlkZXINCiAgICAgIHZhciAkc2xpZGVyID0gJCh0aGlzKS5kYXRhKCdmbGV4c2xpZGVyJyk7DQogICAgICBzd2l0Y2ggKG9wdGlvbnMpIHsNCiAgICAgICAgY2FzZSAicGxheSI6ICRzbGlkZXIucGxheSgpOyBicmVhazsNCiAgICAgICAgY2FzZSAicGF1c2UiOiAkc2xpZGVyLnBhdXNlKCk7IGJyZWFrOw0KICAgICAgICBjYXNlICJuZXh0IjogJHNsaWRlci5mbGV4QW5pbWF0ZSgkc2xpZGVyLmdldFRhcmdldCgibmV4dCIpLCB0cnVlKTsgYnJlYWs7DQogICAgICAgIGNhc2UgInByZXYiOg0KICAgICAgICBjYXNlICJwcmV2aW91cyI6ICRzbGlkZXIuZmxleEFuaW1hdGUoJHNsaWRlci5nZXRUYXJnZXQoInByZXYiKSwgdHJ1ZSk7IGJyZWFrOw0KICAgICAgICBkZWZhdWx0OiBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICJudW1iZXIiKSAkc2xpZGVyLmZsZXhBbmltYXRlKG9wdGlvbnMsIHRydWUpOw0KICAgICAgfQ0KICAgIH0NCiAgfSAgDQoNCn0pKGpRdWVyeSk7" jcr:lastModified="2015-05-29T17:19:44.494+07:00" jcr:mimeType="application/x-javascript"/></jquery.flexslider.js>